<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>NEXMAX Dashboard - Complete Standards Reference v2.0</title>
  <style>
    /* Default styles provided by pandoc.
    ** See https://pandoc.org/MANUAL.html#variables-for-html for config info.
    */
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      border: none;
      border-top: 1px solid #1a1a1a;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">NEXMAX Dashboard - Complete Standards Reference
v2.0</h1>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#ðÿ-nexmax-dashboard---complete-standards-reference"
id="toc-ðÿ-nexmax-dashboard---complete-standards-reference"><span
class="toc-section-number">1</span> ðŸ“˜ NEXMAX DASHBOARD - COMPLETE
STANDARDS REFERENCE</a>
<ul>
<li><a href="#comprehensive-standards-untuk-all-project-pages"
id="toc-comprehensive-standards-untuk-all-project-pages"><span
class="toc-section-number">1.1</span> Comprehensive Standards untuk ALL
Project Pages</a></li>
<li><a href="#ðÿ-table-of-contents" id="toc-ðÿ-table-of-contents"><span
class="toc-section-number">1.2</span> ðŸ“‹ TABLE OF CONTENTS</a>
<ul>
<li><a href="#core-standards" id="toc-core-standards"><span
class="toc-section-number">1.2.1</span> <strong>CORE
STANDARDS</strong></a></li>
<li><a href="#api-standards" id="toc-api-standards"><span
class="toc-section-number">1.2.2</span> <strong>API
STANDARDS</strong></a></li>
<li><a href="#logic-standards" id="toc-logic-standards"><span
class="toc-section-number">1.2.3</span> <strong>LOGIC
STANDARDS</strong></a></li>
<li><a href="#component-standards" id="toc-component-standards"><span
class="toc-section-number">1.2.4</span> <strong>COMPONENT
STANDARDS</strong></a></li>
<li><a href="#page-standards" id="toc-page-standards"><span
class="toc-section-number">1.2.5</span> <strong>PAGE
STANDARDS</strong></a></li>
<li><a href="#advanced-features" id="toc-advanced-features"><span
class="toc-section-number">1.2.6</span> <strong>ADVANCED
FEATURES</strong></a></li>
<li><a href="#quick-reference" id="toc-quick-reference"><span
class="toc-section-number">1.2.7</span> <strong>QUICK
REFERENCE</strong></a></li>
</ul></li>
<li><a href="#project-overview" id="toc-project-overview"><span
class="toc-section-number">1.3</span> 1. PROJECT OVERVIEW</a>
<ul>
<li><a href="#general-info" id="toc-general-info"><span
class="toc-section-number">1.3.1</span> 1.1 General Info</a></li>
<li><a href="#market-structure" id="toc-market-structure"><span
class="toc-section-number">1.3.2</span> 1.2 Market Structure</a></li>
<li><a href="#critical-rules-unchanged"
id="toc-critical-rules-unchanged"><span
class="toc-section-number">1.3.3</span> 1.3 Critical Rules
(UNCHANGED)</a></li>
</ul></li>
<li><a href="#database-architecture"
id="toc-database-architecture"><span
class="toc-section-number">1.4</span> 2. DATABASE ARCHITECTURE</a>
<ul>
<li><a href="#master-tables-high-precision"
id="toc-master-tables-high-precision"><span
class="toc-section-number">1.4.1</span> 2.1 Master Tables (High
Precision)</a></li>
<li><a href="#materialized-views-performance"
id="toc-materialized-views-performance"><span
class="toc-section-number">1.4.2</span> 2.2 Materialized Views
(Performance)</a></li>
<li><a href="#hybrid-approach-best-practice"
id="toc-hybrid-approach-best-practice"><span
class="toc-section-number">1.4.3</span> 2.3 Hybrid Approach (BEST
PRACTICE)</a></li>
</ul></li>
<li><a href="#complete-kpi-reference"
id="toc-complete-kpi-reference"><span
class="toc-section-number">1.5</span> 3. COMPLETE KPI REFERENCE</a>
<ul>
<li><a href="#financial-kpis-format-rm-0000.00"
id="toc-financial-kpis-format-rm-0000.00"><span
class="toc-section-number">1.5.1</span> 3.1 Financial KPIs (Format: RM
0,000.00)</a></li>
<li><a href="#count-kpis-format-0000"
id="toc-count-kpis-format-0000"><span
class="toc-section-number">1.5.2</span> 3.2 Count KPIs (Format:
0,000)</a></li>
<li><a href="#calculated-kpis-format-0000.00"
id="toc-calculated-kpis-format-0000.00"><span
class="toc-section-number">1.5.3</span> 3.3 Calculated KPIs (Format:
0,000.00)</a></li>
<li><a href="#rate-kpis-format-0.00"
id="toc-rate-kpis-format-0.00"><span
class="toc-section-number">1.5.4</span> 3.4 Rate KPIs (Format:
0.00%)</a></li>
<li><a href="#currency-symbols" id="toc-currency-symbols"><span
class="toc-section-number">1.5.5</span> 3.5 Currency Symbols</a></li>
</ul></li>
<li><a href="#slicer-api-standard" id="toc-slicer-api-standard"><span
class="toc-section-number">1.6</span> 4. SLICER API STANDARD</a>
<ul>
<li><a href="#overview" id="toc-overview"><span
class="toc-section-number">1.6.1</span> 4.1 Overview</a></li>
<li><a href="#api-structure" id="toc-api-structure"><span
class="toc-section-number">1.6.2</span> 4.2 API Structure</a></li>
<li><a href="#universal-pattern-all-markets"
id="toc-universal-pattern-all-markets"><span
class="toc-section-number">1.6.3</span> 4.3 Universal Pattern (ALL
Markets)</a></li>
<li><a href="#currency-specific-tables"
id="toc-currency-specific-tables"><span
class="toc-section-number">1.6.4</span> 4.4 Currency-Specific
Tables</a></li>
<li><a href="#client-side-implementation"
id="toc-client-side-implementation"><span
class="toc-section-number">1.6.5</span> 4.5 Client-Side
Implementation</a></li>
<li><a href="#subheader-slicer-ui" id="toc-subheader-slicer-ui"><span
class="toc-section-number">1.6.6</span> 4.6 SubHeader Slicer UI</a></li>
</ul></li>
<li><a href="#data-api-patterns" id="toc-data-api-patterns"><span
class="toc-section-number">1.7</span> 5. DATA API PATTERNS</a>
<ul>
<li><a href="#standard-query-pattern"
id="toc-standard-query-pattern"><span
class="toc-section-number">1.7.1</span> 5.1 Standard Query
Pattern</a></li>
</ul></li>
<li><a href="#export-api-standard" id="toc-export-api-standard"><span
class="toc-section-number">1.8</span> 6. EXPORT API STANDARD</a>
<ul>
<li><a href="#pattern-all-markets" id="toc-pattern-all-markets"><span
class="toc-section-number">1.8.1</span> 6.1 Pattern (ALL
Markets)</a></li>
</ul></li>
<li><a href="#daily-average-logic" id="toc-daily-average-logic"><span
class="toc-section-number">1.9</span> 7. DAILY AVERAGE LOGIC</a>
<ul>
<li><a href="#overview-1" id="toc-overview-1"><span
class="toc-section-number">1.9.1</span> 7.1 Overview</a></li>
<li><a href="#core-logic-universal-untuk-all-markets"
id="toc-core-logic-universal-untuk-all-markets"><span
class="toc-section-number">1.9.2</span> 7.2 Core Logic (Universal untuk
ALL Markets)</a></li>
<li><a href="#usage-in-page-all-markets"
id="toc-usage-in-page-all-markets"><span
class="toc-section-number">1.9.3</span> 7.3 Usage in Page (ALL
Markets)</a></li>
</ul></li>
<li><a href="#month-over-month-mom-comparison"
id="toc-month-over-month-mom-comparison"><span
class="toc-section-number">1.10</span> 8. MONTH-OVER-MONTH (MOM)
COMPARISON</a>
<ul>
<li><a href="#overview-2" id="toc-overview-2"><span
class="toc-section-number">1.10.1</span> 8.1 Overview</a></li>
<li><a href="#core-logic-universal" id="toc-core-logic-universal"><span
class="toc-section-number">1.10.2</span> 8.2 Core Logic
(Universal)</a></li>
<li><a href="#previous-month-calculation"
id="toc-previous-month-calculation"><span
class="toc-section-number">1.10.3</span> 8.3 Previous Month
Calculation</a></li>
<li><a href="#format-mom-display" id="toc-format-mom-display"><span
class="toc-section-number">1.10.4</span> 8.4 Format MoM Display</a></li>
</ul></li>
<li><a href="#kpi-calculation-logic"
id="toc-kpi-calculation-logic"><span
class="toc-section-number">1.11</span> 9. KPI CALCULATION LOGIC</a>
<ul>
<li><a href="#logic-files-by-currency"
id="toc-logic-files-by-currency"><span
class="toc-section-number">1.11.1</span> 9.1 Logic Files by
Currency</a></li>
<li><a href="#usc-formulas-reference---apply-same-untuk-myrsgd"
id="toc-usc-formulas-reference---apply-same-untuk-myrsgd"><span
class="toc-section-number">1.11.2</span> 9.2 USC Formulas (Reference -
Apply Same untuk MYR/SGD)</a></li>
<li><a href="#hybrid-data-fetching-usc-pattern---apply-to-all"
id="toc-hybrid-data-fetching-usc-pattern---apply-to-all"><span
class="toc-section-number">1.11.3</span> 9.3 Hybrid Data Fetching (USC
Pattern - Apply to ALL)</a></li>
</ul></li>
<li><a href="#statcard-standard" id="toc-statcard-standard"><span
class="toc-section-number">1.12</span> 10. STATCARD STANDARD</a>
<ul>
<li><a href="#overview-3" id="toc-overview-3"><span
class="toc-section-number">1.12.1</span> 10.1 Overview</a></li>
<li><a href="#statcard-structure" id="toc-statcard-structure"><span
class="toc-section-number">1.12.2</span> 10.2 StatCard
Structure</a></li>
<li><a href="#props-interface" id="toc-props-interface"><span
class="toc-section-number">1.12.3</span> 10.3 Props Interface</a></li>
<li><a href="#kpi-cards-grid-layout"
id="toc-kpi-cards-grid-layout"><span
class="toc-section-number">1.12.4</span> 10.4 6 KPI Cards Grid
Layout</a></li>
</ul></li>
<li><a href="#linechart-standard" id="toc-linechart-standard"><span
class="toc-section-number">1.13</span> 11. LINECHART STANDARD</a>
<ul>
<li><a href="#overview-4" id="toc-overview-4"><span
class="toc-section-number">1.13.1</span> 11.1 Overview</a></li>
<li><a href="#single-line-usage" id="toc-single-line-usage"><span
class="toc-section-number">1.13.2</span> 11.2 Single Line Usage</a></li>
<li><a href="#chart-configuration-single-line"
id="toc-chart-configuration-single-line"><span
class="toc-section-number">1.13.3</span> 11.3 Chart Configuration
(Single Line)</a></li>
</ul></li>
<li><a href="#dual-line-chart" id="toc-dual-line-chart"><span
class="toc-section-number">1.14</span> 11.4 DUAL LINE CHART</a>
<ul>
<li><a href="#dual-line-overview" id="toc-dual-line-overview"><span
class="toc-section-number">1.14.1</span> Dual Line Overview</a></li>
<li><a href="#dual-line-usage" id="toc-dual-line-usage"><span
class="toc-section-number">1.14.2</span> Dual Line Usage</a></li>
<li><a href="#dual-y-axis-configuration"
id="toc-dual-y-axis-configuration"><span
class="toc-section-number">1.14.3</span> Dual Y-Axis
Configuration</a></li>
</ul></li>
<li><a href="#barchart-standard" id="toc-barchart-standard"><span
class="toc-section-number">1.15</span> 12. BARCHART STANDARD</a>
<ul>
<li><a href="#overview-5" id="toc-overview-5"><span
class="toc-section-number">1.15.1</span> 12.1 Overview</a></li>
<li><a href="#single-bar-usage" id="toc-single-bar-usage"><span
class="toc-section-number">1.15.2</span> 12.2 Single Bar Usage</a></li>
<li><a href="#chart-configuration-single-bar"
id="toc-chart-configuration-single-bar"><span
class="toc-section-number">1.15.3</span> 12.3 Chart Configuration
(Single Bar)</a></li>
</ul></li>
<li><a href="#dual-bar-chart" id="toc-dual-bar-chart"><span
class="toc-section-number">1.16</span> 12.4 DUAL BAR CHART</a>
<ul>
<li><a href="#dual-bar-overview" id="toc-dual-bar-overview"><span
class="toc-section-number">1.16.1</span> Dual Bar Overview</a></li>
<li><a href="#dual-bar-usage" id="toc-dual-bar-usage"><span
class="toc-section-number">1.16.2</span> Dual Bar Usage</a></li>
<li><a href="#dual-bar-configuration"
id="toc-dual-bar-configuration"><span
class="toc-section-number">1.16.3</span> Dual Bar Configuration</a></li>
</ul></li>
<li><a href="#layout-frame-standard"
id="toc-layout-frame-standard"><span
class="toc-section-number">1.17</span> 13. LAYOUT &amp; FRAME
STANDARD</a>
<ul>
<li><a href="#layout-component" id="toc-layout-component"><span
class="toc-section-number">1.17.1</span> 13.1 Layout Component</a></li>
<li><a href="#frame-component" id="toc-frame-component"><span
class="toc-section-number">1.17.2</span> 13.2 Frame Component</a></li>
</ul></li>
<li><a href="#slicer-components" id="toc-slicer-components"><span
class="toc-section-number">1.18</span> 14. SLICER COMPONENTS</a>
<ul>
<li><a href="#available-slicers-7-components"
id="toc-available-slicers-7-components"><span
class="toc-section-number">1.18.1</span> 14.1 Available Slicers (7
components)</a></li>
<li><a href="#standard-slicer-pattern"
id="toc-standard-slicer-pattern"><span
class="toc-section-number">1.18.2</span> 14.2 Standard Slicer
Pattern</a></li>
</ul></li>
<li><a href="#modal-components" id="toc-modal-components"><span
class="toc-section-number">1.19</span> 15. MODAL COMPONENTS</a>
<ul>
<li><a href="#activememberdetailsmodal"
id="toc-activememberdetailsmodal"><span
class="toc-section-number">1.19.1</span> 15.1
ActiveMemberDetailsModal</a></li>
<li><a href="#targeteditmodal" id="toc-targeteditmodal"><span
class="toc-section-number">1.19.2</span> 15.2 TargetEditModal</a></li>
<li><a href="#other-modals" id="toc-other-modals"><span
class="toc-section-number">1.19.3</span> 15.3 Other Modals</a></li>
</ul></li>
<li><a href="#overview-page-pattern"
id="toc-overview-page-pattern"><span
class="toc-section-number">1.20</span> 16. OVERVIEW PAGE PATTERN</a>
<ul>
<li><a href="#structure-all-markets-myr-sgd-usc"
id="toc-structure-all-markets-myr-sgd-usc"><span
class="toc-section-number">1.20.1</span> 16.1 Structure (ALL Markets:
MYR, SGD, USC)</a></li>
</ul></li>
<li><a href="#business-performance-pattern"
id="toc-business-performance-pattern"><span
class="toc-section-number">1.21</span> 17. BUSINESS PERFORMANCE
PATTERN</a>
<ul>
<li><a href="#structure-myr-sgd-usc"
id="toc-structure-myr-sgd-usc"><span
class="toc-section-number">1.21.1</span> 17.1 Structure (MYR, SGD,
USC)</a></li>
</ul></li>
<li><a href="#member-report-pattern"
id="toc-member-report-pattern"><span
class="toc-section-number">1.22</span> 18. MEMBER REPORT PATTERN</a>
<ul>
<li><a href="#structure-all-markets"
id="toc-structure-all-markets"><span
class="toc-section-number">1.22.1</span> 18.1 Structure (ALL
Markets)</a></li>
</ul></li>
<li><a href="#customer-retention-pattern"
id="toc-customer-retention-pattern"><span
class="toc-section-number">1.23</span> 19. CUSTOMER RETENTION
PATTERN</a>
<ul>
<li><a href="#structure-all-markets-1"
id="toc-structure-all-markets-1"><span
class="toc-section-number">1.23.1</span> 19.1 Structure (ALL
Markets)</a></li>
</ul></li>
<li><a href="#server-side-filtering"
id="toc-server-side-filtering"><span
class="toc-section-number">1.24</span> 20. SERVER-SIDE FILTERING</a>
<ul>
<li><a href="#overview-new---nov-2025"
id="toc-overview-new---nov-2025"><span
class="toc-section-number">1.24.1</span> 20.1 Overview (NEW - Nov
2025)</a></li>
<li><a href="#pattern" id="toc-pattern"><span
class="toc-section-number">1.24.2</span> 20.2 Pattern</a></li>
</ul></li>
<li><a href="#brand-access-control" id="toc-brand-access-control"><span
class="toc-section-number">1.25</span> 21. BRAND ACCESS CONTROL</a>
<ul>
<li><a href="#overview-new---nov-2025-1"
id="toc-overview-new---nov-2025-1"><span
class="toc-section-number">1.25.1</span> 21.1 Overview (NEW - Nov
2025)</a></li>
</ul></li>
<li><a href="#transaction-history-drill-down"
id="toc-transaction-history-drill-down"><span
class="toc-section-number">1.26</span> 22. TRANSACTION HISTORY
DRILL-DOWN</a>
<ul>
<li><a href="#overview-new---nov-2025-2"
id="toc-overview-new---nov-2025-2"><span
class="toc-section-number">1.26.1</span> 22.1 Overview (NEW - Nov
2025)</a></li>
</ul></li>
<li><a href="#format-helpers-reference"
id="toc-format-helpers-reference"><span
class="toc-section-number">1.27</span> 23. FORMAT HELPERS REFERENCE</a>
<ul>
<li><a href="#overview-6" id="toc-overview-6"><span
class="toc-section-number">1.27.1</span> 23.1 Overview</a></li>
<li><a href="#format-functions" id="toc-format-functions"><span
class="toc-section-number">1.27.2</span> 23.2 Format Functions</a></li>
<li><a href="#format-standards-all-markets"
id="toc-format-standards-all-markets"><span
class="toc-section-number">1.27.3</span> 23.3 Format Standards (ALL
Markets)</a></li>
</ul></li>
<li><a href="#checklists" id="toc-checklists"><span
class="toc-section-number">1.28</span> 24. CHECKLISTS</a>
<ul>
<li><a href="#new-page-development-checklist"
id="toc-new-page-development-checklist"><span
class="toc-section-number">1.28.1</span> 24.1 New Page Development
Checklist</a></li>
<li><a href="#api-development-checklist"
id="toc-api-development-checklist"><span
class="toc-section-number">1.28.2</span> 24.2 API Development
Checklist</a></li>
<li><a href="#component-usage-checklist"
id="toc-component-usage-checklist"><span
class="toc-section-number">1.28.3</span> 24.3 Component Usage
Checklist</a></li>
</ul></li>
<li><a href="#troubleshooting" id="toc-troubleshooting"><span
class="toc-section-number">1.29</span> 25. TROUBLESHOOTING</a>
<ul>
<li><a href="#common-issues-solutions"
id="toc-common-issues-solutions"><span
class="toc-section-number">1.29.1</span> 25.1 Common Issues &amp;
Solutions</a></li>
</ul></li>
<li><a href="#ðÿš-summary-checklist"
id="toc-ðÿš-summary-checklist"><span
class="toc-section-number">1.30</span> ðŸ“Š SUMMARY CHECKLIST</a></li>
<li><a href="#ðÿš-summary-checklist-1"
id="toc-ðÿš-summary-checklist-1"><span
class="toc-section-number">1.31</span> ðŸ“Š SUMMARY CHECKLIST</a>
<ul>
<li><a href="#âœ-slicer" id="toc-âœ-slicer"><span
class="toc-section-number">1.31.1</span> âœ… SLICER</a></li>
<li><a href="#âœ-data-loading" id="toc-âœ-data-loading"><span
class="toc-section-number">1.31.2</span> âœ… DATA LOADING</a></li>
<li><a href="#âœ-kpi-cards" id="toc-âœ-kpi-cards"><span
class="toc-section-number">1.31.3</span> âœ… KPI CARDS</a></li>
<li><a href="#âœ-charts" id="toc-âœ-charts"><span
class="toc-section-number">1.31.4</span> âœ… CHARTS</a></li>
<li><a href="#âœ-formatting" id="toc-âœ-formatting"><span
class="toc-section-number">1.31.5</span> âœ… FORMATTING</a></li>
<li><a href="#âœ-styling" id="toc-âœ-styling"><span
class="toc-section-number">1.31.6</span> âœ… STYLING</a></li>
<li><a href="#âœ-advanced" id="toc-âœ-advanced"><span
class="toc-section-number">1.31.7</span> âœ… ADVANCED</a></li>
</ul></li>
<li><a href="#ðÿž-final-notes" id="toc-ðÿž-final-notes"><span
class="toc-section-number">1.32</span> ðŸŽ¯ FINAL NOTES</a></li>
</ul></li>
</ul>
</nav>
<h1 data-number="1"
id="ðÿ-nexmax-dashboard---complete-standards-reference"><span
class="header-section-number">1</span> ðŸ“˜ NEXMAX DASHBOARD - COMPLETE
STANDARDS REFERENCE</h1>
<h2 data-number="1.1"
id="comprehensive-standards-untuk-all-project-pages"><span
class="header-section-number">1.1</span> Comprehensive Standards untuk
ALL Project Pages</h2>
<blockquote>
<p><strong>Project</strong>: NEXMAX Dashboard - Real-time Business
Analytics Platform<br />
<strong>Last Updated</strong>: November 7, 2025<br />
<strong>Scope</strong>: ALL 42 Production Pages (MYR, SGD, USC,
Admin)<br />
<strong>Version</strong>: 2.0 (Expanded &amp; Updated)<br />
<strong>Tujuan</strong>: Single source of truth untuk semua development
standards</p>
<p><strong>Related Docs</strong>: -
<code>CRM_DASHBOARD_HANDBOOK.md</code> - Development handbook -
<code>COMPREHENSIVE_PROJECT_SCAN_REPORT.md</code> - Complete project
analysis - <code>COMPONENTS_LIBRARY.md</code> - Component
documentation</p>
</blockquote>
<hr />
<h2 data-number="1.2" id="ðÿ-table-of-contents"><span
class="header-section-number">1.2</span> ðŸ“‹ TABLE OF CONTENTS</h2>
<h3 data-number="1.2.1" id="core-standards"><span
class="header-section-number">1.2.1</span> <strong>CORE
STANDARDS</strong></h3>
<ol type="1">
<li><a href="#1-project-overview">Project Overview</a></li>
<li><a href="#2-database-architecture">Database Architecture</a></li>
<li><a href="#3-complete-kpi-reference">Complete KPI Reference</a></li>
</ol>
<h3 data-number="1.2.2" id="api-standards"><span
class="header-section-number">1.2.2</span> <strong>API
STANDARDS</strong></h3>
<ol start="4" type="1">
<li><a href="#4-slicer-api-standard">Slicer API Standard</a></li>
<li><a href="#5-data-api-patterns">Data API Patterns</a></li>
<li><a href="#6-export-api-standard">Export API Standard</a></li>
</ol>
<h3 data-number="1.2.3" id="logic-standards"><span
class="header-section-number">1.2.3</span> <strong>LOGIC
STANDARDS</strong></h3>
<ol start="7" type="1">
<li><a href="#7-daily-average-logic">Daily Average Logic</a></li>
<li><a href="#8-month-over-month-mom-comparison">Month-over-Month (MoM)
Comparison</a></li>
<li><a href="#9-kpi-calculation-logic">KPI Calculation Logic</a></li>
</ol>
<h3 data-number="1.2.4" id="component-standards"><span
class="header-section-number">1.2.4</span> <strong>COMPONENT
STANDARDS</strong></h3>
<ol start="10" type="1">
<li><a href="#10-statcard-standard">StatCard Standard</a></li>
<li><a href="#11-linechart-standard">LineChart Standard</a></li>
<li><a href="#12-barchart-standard">BarChart Standard</a></li>
<li><a href="#13-layout--frame-standard">Layout &amp; Frame
Standard</a></li>
<li><a href="#14-slicer-components">Slicer Components</a></li>
<li><a href="#15-modal-components">Modal Components</a></li>
</ol>
<h3 data-number="1.2.5" id="page-standards"><span
class="header-section-number">1.2.5</span> <strong>PAGE
STANDARDS</strong></h3>
<ol start="16" type="1">
<li><a href="#16-overview-page-pattern">Overview Page Pattern</a></li>
<li><a href="#17-business-performance-pattern">Business Performance
Pattern</a></li>
<li><a href="#18-member-report-pattern">Member Report Pattern</a></li>
<li><a href="#19-customer-retention-pattern">Customer Retention
Pattern</a></li>
</ol>
<h3 data-number="1.2.6" id="advanced-features"><span
class="header-section-number">1.2.6</span> <strong>ADVANCED
FEATURES</strong></h3>
<ol start="20" type="1">
<li><a href="#20-server-side-filtering">Server-Side Filtering</a></li>
<li><a href="#21-brand-access-control">Brand Access Control</a></li>
<li><a href="#22-transaction-history-drill-down">Transaction History
Drill-Down</a></li>
<li><a href="#23-format-helpers-reference">Format Helpers
Reference</a></li>
</ol>
<h3 data-number="1.2.7" id="quick-reference"><span
class="header-section-number">1.2.7</span> <strong>QUICK
REFERENCE</strong></h3>
<ol start="24" type="1">
<li><a href="#24-checklists">Checklists</a></li>
<li><a href="#25-troubleshooting">Troubleshooting</a></li>
</ol>
<hr />
<h2 data-number="1.3" id="project-overview"><span
class="header-section-number">1.3</span> 1. PROJECT OVERVIEW</h2>
<h3 data-number="1.3.1" id="general-info"><span
class="header-section-number">1.3.1</span> 1.1 General Info</h3>
<p><strong>Total Pages</strong>: 42 production pages - MYR: 15 pages -
SGD: 11 pages<br />
- USC: 9 pages - Admin: 4 pages - Others: 3 pages</p>
<p><strong>Total API Routes</strong>: 94 routes <strong>Total
Components</strong>: 34 components <strong>Total KPIs</strong>: 55+ KPIs
<strong>Total Logic Files</strong>: 16 files</p>
<h3 data-number="1.3.2" id="market-structure"><span
class="header-section-number">1.3.2</span> 1.2 Market Structure</h3>
<p><strong>MYR Pages</strong> (Malaysian Ringgit - RM):</p>
<pre><code>/myr/overview
/myr/business-performance
/myr/brand-performance-trends
/myr/member-analytic
/myr/member-report
/myr/customer-retention
/myr/churn-member
/myr/kpi-comparison
/myr/auto-approval-monitor
/myr/auto-approval-withdraw
/myr/aia-candy-tracking
/myr/overall-label</code></pre>
<p><strong>SGD Pages</strong> (Singapore Dollar - SGD):</p>
<pre><code>/sgd/overview
/sgd/business-performance
/sgd/brand-performance-trends
/sgd/member-analytic
/sgd/member-report
/sgd/customer-retention
/sgd/churn-member
/sgd/kpi-comparison
/sgd/auto-approval-monitor
/sgd/aia-candy-tracking</code></pre>
<p><strong>USC Pages</strong> (US Cent - USD):</p>
<pre><code>/usc/overview
/usc/business-performance
/usc/brand-performance-trends
/usc/member-analytic
/usc/member-report
/usc/customer-retention
/usc/churn-member
/usc/kpi-comparison
/usc/auto-approval-monitor</code></pre>
<h3 data-number="1.3.3" id="critical-rules-unchanged"><span
class="header-section-number">1.3.3</span> 1.3 Critical Rules
(UNCHANGED)</h3>
<ol type="1">
<li>âŒ <strong>NO DUMMY DATA</strong> - Semua data dari Supabase</li>
<li>âœ… <strong>API-FIRST</strong> - Slicers auto-fetch dari
database</li>
<li>âœ… <strong>CURRENCY LOCK</strong> - MYR/SGD/USC pages lock
currency</li>
<li>âœ… <strong>REAL-TIME</strong> - Data selalu up-to-date</li>
<li>âœ… <strong>UNLIMITED DATA</strong> - No arbitrary limits</li>
<li>âœ… <strong>BRAND ACCESS</strong> - Squad Lead filtering
implemented</li>
<li>âœ… <strong>SERVER-SIDE</strong> - Filtering di server untuk
performance</li>
<li>âœ… <strong>CONSISTENT FORMAT</strong> - formatHelpers untuk all
displays</li>
<li>âœ… <strong>CENTRALIZED ICONS</strong> - CentralIcon system</li>
<li>âœ… <strong>STANDARD COMPONENTS</strong> - Reusable component
library</li>
</ol>
<hr />
<h2 data-number="1.4" id="database-architecture"><span
class="header-section-number">1.4</span> 2. DATABASE ARCHITECTURE</h2>
<h3 data-number="1.4.1" id="master-tables-high-precision"><span
class="header-section-number">1.4.1</span> 2.1 Master Tables (High
Precision)</h3>
<p><strong>Structure</strong>: Same untuk MYR/SGD/USC</p>
<table>
<colgroup>
<col style="width: 24%" />
<col style="width: 31%" />
<col style="width: 44%" />
</colgroup>
<thead>
<tr>
<th>Table</th>
<th>Purpose</th>
<th>Key Columns</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>blue_whale_myr</code></td>
<td>MYR daily transactions</td>
<td>userkey, unique_code, date, deposit_cases, amounts</td>
</tr>
<tr>
<td><code>blue_whale_sgd</code></td>
<td>SGD daily transactions</td>
<td>Same structure</td>
</tr>
<tr>
<td><code>blue_whale_usc</code></td>
<td>USC daily transactions</td>
<td>Same structure</td>
</tr>
</tbody>
</table>
<p><strong>Use For</strong>: - âœ… Active Member (COUNT DISTINCT
userkey) - âœ… Pure User (COUNT DISTINCT unique_code) - âœ… Churn Member
(cohort comparison) - âœ… Retention/Reactivation analysis</p>
<h3 data-number="1.4.2" id="materialized-views-performance"><span
class="header-section-number">1.4.2</span> 2.2 Materialized Views
(Performance)</h3>
<table>
<colgroup>
<col style="width: 31%" />
<col style="width: 40%" />
<col style="width: 28%" />
</colgroup>
<thead>
<tr>
<th>MV Table</th>
<th>Aggregation</th>
<th>Refresh</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>blue_whale_myr_monthly_summary</code></td>
<td>Per line + month</td>
<td>Manual/Scheduled</td>
</tr>
<tr>
<td><code>blue_whale_sgd_monthly_summary</code></td>
<td>Per line + month</td>
<td>Manual/Scheduled</td>
</tr>
<tr>
<td><code>blue_whale_usc_summary</code></td>
<td>Per line + month</td>
<td>Manual/Scheduled</td>
</tr>
<tr>
<td><code>bp_daily_summary_myr</code></td>
<td>Per date + line</td>
<td>Manual/Scheduled</td>
</tr>
<tr>
<td><code>bp_quarter_summary_myr</code></td>
<td>Per quarter + line</td>
<td>Manual/Scheduled</td>
</tr>
</tbody>
</table>
<p><strong>Use For</strong>: - âœ… Deposit/Withdraw Amounts - âœ… Cases
counts - âœ… Bonuses - âœ… Pre-calculated KPIs (ATV, Winrate, etc.)</p>
<h3 data-number="1.4.3" id="hybrid-approach-best-practice"><span
class="header-section-number">1.4.3</span> 2.3 Hybrid Approach (BEST
PRACTICE)</h3>
<div class="sourceCode" id="cb4"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">// PRECISION metrics from MASTER table</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> activeMember <span class="op">=</span> <span class="cf">await</span> <span class="fu">getFromMaster</span>(<span class="st">&#39;blue_whale_usc&#39;</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;userkey&#39;</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">distinct</span>()</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">count</span>()</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">// PERFORMANCE metrics from MV table  </span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> { deposit_amount<span class="op">,</span> withdraw_amount } <span class="op">=</span> <span class="cf">await</span> <span class="fu">getFromMV</span>(<span class="st">&#39;blue_whale_usc_summary&#39;</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;deposit_amount, withdraw_amount&#39;</span>)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">sum</span>()</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co">// COMBINE for complete KPI data</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> kpiData <span class="op">=</span> {</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  activeMember<span class="op">,</span>          <span class="co">// From Master (precision)</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  depositAmount<span class="op">,</span>         <span class="co">// From MV (performance)</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  ggrUser<span class="op">:</span> netProfit <span class="op">/</span> activeMember  <span class="co">// Calculated</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<hr />
<h2 data-number="1.5" id="complete-kpi-reference"><span
class="header-section-number">1.5</span> 3. COMPLETE KPI REFERENCE</h2>
<h3 data-number="1.5.1" id="financial-kpis-format-rm-0000.00"><span
class="header-section-number">1.5.1</span> 3.1 Financial KPIs (Format:
RM 0,000.00)</h3>
<table>
<colgroup>
<col style="width: 17%" />
<col style="width: 31%" />
<col style="width: 17%" />
<col style="width: 17%" />
<col style="width: 17%" />
</colgroup>
<thead>
<tr>
<th>KPI</th>
<th>Formula</th>
<th>MYR</th>
<th>SGD</th>
<th>USC</th>
</tr>
</thead>
<tbody>
<tr>
<td>Deposit Amount</td>
<td>SUM(deposit_amount)</td>
<td>âœ…</td>
<td>âœ…</td>
<td>âœ…</td>
</tr>
<tr>
<td>Withdraw Amount</td>
<td>SUM(withdraw_amount)</td>
<td>âœ…</td>
<td>âœ…</td>
<td>âœ…</td>
</tr>
<tr>
<td>GGR</td>
<td>Deposit - Withdraw</td>
<td>âœ…</td>
<td>âœ…</td>
<td>âœ…</td>
</tr>
<tr>
<td>Net Profit</td>
<td>(Deposit + Add Trans) - (Withdraw + Deduct Trans)</td>
<td>âœ…</td>
<td>âœ…</td>
<td>âœ…</td>
</tr>
<tr>
<td>Add Transaction</td>
<td>SUM(add_transaction)</td>
<td>âœ…</td>
<td>âœ…</td>
<td>âœ…</td>
</tr>
<tr>
<td>Deduct Transaction</td>
<td>SUM(deduct_transaction)</td>
<td>âœ…</td>
<td>âœ…</td>
<td>âœ…</td>
</tr>
<tr>
<td>Add Bonus</td>
<td>SUM(add_bonus)</td>
<td>âœ…</td>
<td>âœ…</td>
<td>âœ…</td>
</tr>
<tr>
<td>Deduct Bonus</td>
<td>SUM(deduct_bonus)</td>
<td>âœ…</td>
<td>âœ…</td>
<td>âœ…</td>
</tr>
<tr>
<td>Bonus</td>
<td>SUM(bonus)</td>
<td>âœ…</td>
<td>âœ…</td>
<td>âœ…</td>
</tr>
<tr>
<td>Valid Bet Amount</td>
<td>SUM(valid_amount)</td>
<td>âœ…</td>
<td>âœ…</td>
<td>âœ…</td>
</tr>
</tbody>
</table>
<h3 data-number="1.5.2" id="count-kpis-format-0000"><span
class="header-section-number">1.5.2</span> 3.2 Count KPIs (Format:
0,000)</h3>
<table>
<colgroup>
<col style="width: 22%" />
<col style="width: 40%" />
<col style="width: 36%" />
</colgroup>
<thead>
<tr>
<th>KPI</th>
<th>Formula</th>
<th>Source</th>
</tr>
</thead>
<tbody>
<tr>
<td>Active Member</td>
<td>COUNT DISTINCT(userkey) WHERE deposit_cases &gt; 0</td>
<td>Master</td>
</tr>
<tr>
<td>Pure User</td>
<td>COUNT DISTINCT(unique_code) WHERE deposit_cases &gt; 0</td>
<td>Master</td>
</tr>
<tr>
<td>Pure Member</td>
<td>Active Member - New Depositor</td>
<td>Calculated</td>
</tr>
<tr>
<td>New Depositor</td>
<td>COUNT new depositors in period</td>
<td>MV</td>
</tr>
<tr>
<td>New Register</td>
<td>COUNT new registrations</td>
<td>MV/Join</td>
</tr>
<tr>
<td>Churn Member</td>
<td>Users in prev month NOT in current</td>
<td>Master</td>
</tr>
<tr>
<td>Deposit Cases</td>
<td>SUM(deposit_cases)</td>
<td>MV</td>
</tr>
<tr>
<td>Withdraw Cases</td>
<td>SUM(withdraw_cases)</td>
<td>MV</td>
</tr>
</tbody>
</table>
<h3 data-number="1.5.3" id="calculated-kpis-format-0000.00"><span
class="header-section-number">1.5.3</span> 3.3 Calculated KPIs (Format:
0,000.00)</h3>
<table>
<thead>
<tr>
<th>KPI</th>
<th>Formula</th>
<th>ALL Markets</th>
</tr>
</thead>
<tbody>
<tr>
<td>ATV</td>
<td>Deposit Amount / Deposit Cases</td>
<td>âœ…</td>
</tr>
<tr>
<td>PF</td>
<td>Deposit Cases / Active Member</td>
<td>âœ…</td>
</tr>
<tr>
<td>ACL</td>
<td>1 / (Churn Rate / 100)</td>
<td>âœ…</td>
</tr>
<tr>
<td>CLV</td>
<td>ATV Ã— PF Ã— ACL</td>
<td>âœ…</td>
</tr>
<tr>
<td>CMI</td>
<td>(Retention Ã— 0.5) + (Growth Ã— 0.5) + (Churn Ã— 0.2)</td>
<td>âœ…</td>
</tr>
<tr>
<td>GGR User</td>
<td>Net Profit / Active Member</td>
<td>âœ…</td>
</tr>
<tr>
<td>GGR Pure User</td>
<td>GGR / Pure Member</td>
<td>âœ…</td>
</tr>
<tr>
<td>DA User</td>
<td>Deposit Amount / Active Member</td>
<td>âœ…</td>
</tr>
</tbody>
</table>
<h3 data-number="1.5.4" id="rate-kpis-format-0.00"><span
class="header-section-number">1.5.4</span> 3.4 Rate KPIs (Format:
0.00%)</h3>
<table>
<thead>
<tr>
<th>KPI</th>
<th>Formula</th>
<th>ALL Markets</th>
</tr>
</thead>
<tbody>
<tr>
<td>Winrate</td>
<td>(GGR / Deposit Amount) Ã— 100</td>
<td>âœ…</td>
</tr>
<tr>
<td>Churn Rate</td>
<td>(Churn / Last Month Active) Ã— 100</td>
<td>âœ…</td>
</tr>
<tr>
<td>Retention Rate</td>
<td>(1 - Churn Rate/100) Ã— 100</td>
<td>âœ…</td>
</tr>
<tr>
<td>Growth Rate</td>
<td>((Active - Churn) / Active) Ã— 100</td>
<td>âœ…</td>
</tr>
<tr>
<td>Withdrawal Rate</td>
<td>(Withdraw Cases / Deposit Cases) Ã— 100</td>
<td>âœ…</td>
</tr>
<tr>
<td>Conversion Rate</td>
<td>(New Depositor / New Register) Ã— 100</td>
<td>âœ…</td>
</tr>
<tr>
<td>Hold Percentage</td>
<td>(Net Profit / Valid Amount) Ã— 100</td>
<td>âœ…</td>
</tr>
</tbody>
</table>
<h3 data-number="1.5.5" id="currency-symbols"><span
class="header-section-number">1.5.5</span> 3.5 Currency Symbols</h3>
<table>
<thead>
<tr>
<th>Currency</th>
<th>Symbol</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>MYR</td>
<td>RM</td>
<td>RM 1,234,567.89</td>
</tr>
<tr>
<td>SGD</td>
<td>SGD</td>
<td>SGD 1,234,567.89</td>
</tr>
<tr>
<td>USC</td>
<td>USD</td>
<td>USD 1,234,567.89</td>
</tr>
<tr>
<td>ALL</td>
<td>RM</td>
<td>RM 1,234,567.89 (converted to MYR)</td>
</tr>
</tbody>
</table>
<hr />
<h2 data-number="1.6" id="slicer-api-standard"><span
class="header-section-number">1.6</span> 4. SLICER API STANDARD</h2>
<h3 data-number="1.6.1" id="overview"><span
class="header-section-number">1.6.1</span> 4.1 Overview</h3>
<p>Slicer di NEXMAX menggunakan <strong>API-first architecture</strong>
dengan auto-fetch dari database untuk SEMUA markets (MYR, SGD, USC).</p>
<h3 data-number="1.6.2" id="api-structure"><span
class="header-section-number">1.6.2</span> 4.2 API Structure</h3>
<p><strong>Location</strong>:
<code>app/api/{currency}-{feature}/slicer-options/route.ts</code></p>
<p><strong>Examples</strong>: -
<code>app/api/myr-overview/slicer-options/route.ts</code> -
<code>app/api/sgd-business-performance/slicer-options/route.ts</code> -
<code>app/api/usc-member-analytic/slicer-options/route.ts</code></p>
<h3 data-number="1.6.3" id="universal-pattern-all-markets"><span
class="header-section-number">1.6.3</span> 4.3 Universal Pattern (ALL
Markets)</h3>
<div class="sourceCode" id="cb5"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">async</span> <span class="kw">function</span> <span class="fu">GET</span>(request<span class="op">:</span> NextRequest) {</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span> {</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get user&#39;s allowed brands from header</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> userAllowedBrandsHeader <span class="op">=</span> request<span class="op">.</span><span class="at">headers</span><span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;x-user-allowed-brands&#39;</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> userAllowedBrands <span class="op">=</span> userAllowedBrandsHeader <span class="op">?</span> </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>      <span class="bu">JSON</span><span class="op">.</span><span class="fu">parse</span>(userAllowedBrandsHeader) <span class="op">:</span> <span class="kw">null</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 1. Get DISTINCT lines from database</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// MYR: blue_whale_myr_monthly_summary</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// SGD: blue_whale_sgd_monthly_summary  </span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// USC: blue_whale_usc_summary</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> { data<span class="op">:</span> allLines } <span class="op">=</span> <span class="cf">await</span> supabase</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">from</span>(<span class="st">&#39;blue_whale_myr_monthly_summary&#39;</span>)  <span class="co">// Change per currency</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;line&#39;</span>)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">eq</span>(<span class="st">&#39;currency&#39;</span><span class="op">,</span> <span class="st">&#39;MYR&#39;</span>)  <span class="co">// Change per currency</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">not</span>(<span class="st">&#39;line&#39;</span><span class="op">,</span> <span class="st">&#39;is&#39;</span><span class="op">,</span> <span class="kw">null</span>)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> uniqueLines <span class="op">=</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>(<span class="kw">new</span> <span class="bu">Set</span>(allLines<span class="op">?.</span><span class="fu">map</span>(r <span class="kw">=&gt;</span> r<span class="op">.</span><span class="at">line</span>)))</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> cleanLines <span class="op">=</span> uniqueLines<span class="op">.</span><span class="fu">filter</span>(line <span class="kw">=&gt;</span> line <span class="op">!==</span> <span class="st">&#39;ALL&#39;</span>)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Apply brand filtering (NEW - Nov 2025)</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> filteredBrands <span class="op">=</span> userAllowedBrands <span class="op">&amp;&amp;</span> userAllowedBrands<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>      <span class="op">?</span> cleanLines<span class="op">.</span><span class="fu">filter</span>(brand <span class="kw">=&gt;</span> userAllowedBrands<span class="op">.</span><span class="fu">includes</span>(brand))</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> cleanLines</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> finalLines <span class="op">=</span> userAllowedBrands <span class="op">&amp;&amp;</span> userAllowedBrands<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>      <span class="op">?</span> filteredBrands<span class="op">.</span><span class="fu">sort</span>()  <span class="co">// Squad Lead: no ALL option</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> [<span class="st">&#39;ALL&#39;</span><span class="op">,</span> <span class="op">...</span>cleanLines<span class="op">.</span><span class="fu">sort</span>()]  <span class="co">// Admin: ALL + brands</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 2. Get years</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> { data<span class="op">:</span> allYears } <span class="op">=</span> <span class="cf">await</span> supabase</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">from</span>(<span class="st">&#39;blue_whale_myr_monthly_summary&#39;</span>)</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;year&#39;</span>)</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">eq</span>(<span class="st">&#39;currency&#39;</span><span class="op">,</span> <span class="st">&#39;MYR&#39;</span>)</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">not</span>(<span class="st">&#39;year&#39;</span><span class="op">,</span> <span class="st">&#39;is&#39;</span><span class="op">,</span> <span class="kw">null</span>)</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> sortedYears <span class="op">=</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>(<span class="kw">new</span> <span class="bu">Set</span>(allYears<span class="op">?.</span><span class="fu">map</span>(r <span class="kw">=&gt;</span> r<span class="op">.</span><span class="at">year</span><span class="op">?.</span><span class="fu">toString</span>())))</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span> <span class="pp">parseInt</span>(b) <span class="op">-</span> <span class="pp">parseInt</span>(a))</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 3. Get months WITH year mapping (DYNAMIC FILTERING)</span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> { data<span class="op">:</span> allMonthsData } <span class="op">=</span> <span class="cf">await</span> supabase</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">from</span>(<span class="st">&#39;blue_whale_myr_monthly_summary&#39;</span>)</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;month, year&#39;</span>)</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">eq</span>(<span class="st">&#39;currency&#39;</span><span class="op">,</span> <span class="st">&#39;MYR&#39;</span>)</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">gt</span>(<span class="st">&#39;month&#39;</span><span class="op">,</span> <span class="dv">0</span>)  <span class="co">// Exclude rollup (month=0)</span></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">not</span>(<span class="st">&#39;month&#39;</span><span class="op">,</span> <span class="st">&#39;is&#39;</span><span class="op">,</span> <span class="kw">null</span>)</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 4. Build month-year mapping for DYNAMIC filtering</span></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> monthYearMap<span class="op">:</span> <span class="bu">Record</span><span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> <span class="bu">Set</span><span class="op">&lt;</span><span class="dt">string</span><span class="op">&gt;&gt;</span> <span class="op">=</span> {}</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>    allMonthsData<span class="op">?.</span><span class="fu">forEach</span>(row <span class="kw">=&gt;</span> {</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> monthKey <span class="op">=</span> <span class="bu">String</span>(row<span class="op">.</span><span class="at">month</span>)</span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> yearValue <span class="op">=</span> <span class="bu">String</span>(row<span class="op">.</span><span class="at">year</span>)</span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="op">!</span>monthYearMap[monthKey]) {</span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>        monthYearMap[monthKey] <span class="op">=</span> <span class="kw">new</span> <span class="bu">Set</span>()</span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>      monthYearMap[monthKey]<span class="op">.</span><span class="fu">add</span>(yearValue)</span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Convert month numbers to month objects with year mapping</span></span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> monthNames <span class="op">=</span> [<span class="st">&#39;January&#39;</span><span class="op">,</span> <span class="st">&#39;February&#39;</span><span class="op">,</span> <span class="st">&#39;March&#39;</span><span class="op">,</span> <span class="st">&#39;April&#39;</span><span class="op">,</span> <span class="st">&#39;May&#39;</span><span class="op">,</span> <span class="st">&#39;June&#39;</span><span class="op">,</span></span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&#39;July&#39;</span><span class="op">,</span> <span class="st">&#39;August&#39;</span><span class="op">,</span> <span class="st">&#39;September&#39;</span><span class="op">,</span> <span class="st">&#39;October&#39;</span><span class="op">,</span> <span class="st">&#39;November&#39;</span><span class="op">,</span> <span class="st">&#39;December&#39;</span>]</span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> months <span class="op">=</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">keys</span>(monthYearMap)</span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">map</span>(monthNum <span class="kw">=&gt;</span> ({</span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a>        value<span class="op">:</span> monthNames[<span class="pp">parseInt</span>(monthNum) <span class="op">-</span> <span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a>        label<span class="op">:</span> monthNames[<span class="pp">parseInt</span>(monthNum) <span class="op">-</span> <span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a>        years<span class="op">:</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>(monthYearMap[monthNum])</span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a>      }))</span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span> monthNames<span class="op">.</span><span class="fu">indexOf</span>(a<span class="op">.</span><span class="at">value</span>) <span class="op">-</span> monthNames<span class="op">.</span><span class="fu">indexOf</span>(b<span class="op">.</span><span class="at">value</span>))</span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a>    months<span class="op">.</span><span class="fu">unshift</span>({ value<span class="op">:</span> <span class="st">&#39;ALL&#39;</span><span class="op">,</span> label<span class="op">:</span> <span class="st">&#39;All&#39;</span><span class="op">,</span> years<span class="op">:</span> sortedYears })</span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 5. Get defaults from latest record</span></span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> { data<span class="op">:</span> latestRecord } <span class="op">=</span> <span class="cf">await</span> supabase</span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">from</span>(<span class="st">&#39;blue_whale_myr_monthly_summary&#39;</span>)</span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;year, month&#39;</span>)</span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">eq</span>(<span class="st">&#39;currency&#39;</span><span class="op">,</span> <span class="st">&#39;MYR&#39;</span>)</span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">gt</span>(<span class="st">&#39;month&#39;</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">order</span>(<span class="st">&#39;year&#39;</span><span class="op">,</span> { ascending<span class="op">:</span> <span class="kw">false</span> })</span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">order</span>(<span class="st">&#39;month&#39;</span><span class="op">,</span> { ascending<span class="op">:</span> <span class="kw">false</span> })</span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">limit</span>(<span class="dv">1</span>)</span>
<span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-83"><a href="#cb5-83" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> defaultYear <span class="op">=</span> latestRecord<span class="op">?.</span>[<span class="dv">0</span>]<span class="op">?.</span><span class="at">year</span><span class="op">?.</span><span class="fu">toString</span>() <span class="op">||</span> sortedYears[<span class="dv">0</span>]</span>
<span id="cb5-84"><a href="#cb5-84" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> defaultMonthNum <span class="op">=</span> latestRecord<span class="op">?.</span>[<span class="dv">0</span>]<span class="op">?.</span><span class="at">month</span> <span class="op">||</span> <span class="dv">9</span></span>
<span id="cb5-85"><a href="#cb5-85" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> defaultMonth <span class="op">=</span> monthNames[defaultMonthNum <span class="op">-</span> <span class="dv">1</span>]</span>
<span id="cb5-86"><a href="#cb5-86" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-87"><a href="#cb5-87" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 6. Return slicer options</span></span>
<span id="cb5-88"><a href="#cb5-88" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> NextResponse<span class="op">.</span><span class="fu">json</span>({</span>
<span id="cb5-89"><a href="#cb5-89" aria-hidden="true" tabindex="-1"></a>      success<span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb5-90"><a href="#cb5-90" aria-hidden="true" tabindex="-1"></a>      data<span class="op">:</span> {</span>
<span id="cb5-91"><a href="#cb5-91" aria-hidden="true" tabindex="-1"></a>        currencies<span class="op">:</span> [<span class="st">&#39;MYR&#39;</span>]<span class="op">,</span> <span class="co">// Locked for currency-specific pages</span></span>
<span id="cb5-92"><a href="#cb5-92" aria-hidden="true" tabindex="-1"></a>        lines<span class="op">:</span> finalLines<span class="op">,</span>  <span class="co">// With brand filtering applied</span></span>
<span id="cb5-93"><a href="#cb5-93" aria-hidden="true" tabindex="-1"></a>        years<span class="op">:</span> sortedYears<span class="op">,</span></span>
<span id="cb5-94"><a href="#cb5-94" aria-hidden="true" tabindex="-1"></a>        months<span class="op">:</span> months<span class="op">,</span></span>
<span id="cb5-95"><a href="#cb5-95" aria-hidden="true" tabindex="-1"></a>        defaults<span class="op">:</span> {</span>
<span id="cb5-96"><a href="#cb5-96" aria-hidden="true" tabindex="-1"></a>          currency<span class="op">:</span> <span class="st">&#39;MYR&#39;</span><span class="op">,</span></span>
<span id="cb5-97"><a href="#cb5-97" aria-hidden="true" tabindex="-1"></a>          line<span class="op">:</span> userAllowedBrands <span class="op">&amp;&amp;</span> userAllowedBrands<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span></span>
<span id="cb5-98"><a href="#cb5-98" aria-hidden="true" tabindex="-1"></a>            <span class="op">?</span> userAllowedBrands[<span class="dv">0</span>]  <span class="co">// Squad Lead: first assigned brand</span></span>
<span id="cb5-99"><a href="#cb5-99" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span> <span class="st">&#39;ALL&#39;</span><span class="op">,</span>  <span class="co">// Admin/Manager: ALL</span></span>
<span id="cb5-100"><a href="#cb5-100" aria-hidden="true" tabindex="-1"></a>          year<span class="op">:</span> defaultYear<span class="op">,</span></span>
<span id="cb5-101"><a href="#cb5-101" aria-hidden="true" tabindex="-1"></a>          month<span class="op">:</span> defaultMonth</span>
<span id="cb5-102"><a href="#cb5-102" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb5-103"><a href="#cb5-103" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-104"><a href="#cb5-104" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb5-105"><a href="#cb5-105" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">catch</span> (error) {</span>
<span id="cb5-106"><a href="#cb5-106" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">error</span>(<span class="st">&#39;Error fetching slicer options:&#39;</span><span class="op">,</span> error)</span>
<span id="cb5-107"><a href="#cb5-107" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> NextResponse<span class="op">.</span><span class="fu">json</span>({ </span>
<span id="cb5-108"><a href="#cb5-108" aria-hidden="true" tabindex="-1"></a>      success<span class="op">:</span> <span class="kw">false</span><span class="op">,</span> </span>
<span id="cb5-109"><a href="#cb5-109" aria-hidden="true" tabindex="-1"></a>      error<span class="op">:</span> <span class="st">&#39;Failed to load slicer options&#39;</span> </span>
<span id="cb5-110"><a href="#cb5-110" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span> { status<span class="op">:</span> <span class="dv">500</span> })</span>
<span id="cb5-111"><a href="#cb5-111" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-112"><a href="#cb5-112" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 data-number="1.6.4" id="currency-specific-tables"><span
class="header-section-number">1.6.4</span> 4.4 Currency-Specific
Tables</h3>
<table>
<thead>
<tr>
<th>Currency</th>
<th>MV Table</th>
<th>Master Table</th>
</tr>
</thead>
<tbody>
<tr>
<td>MYR</td>
<td><code>blue_whale_myr_monthly_summary</code></td>
<td><code>blue_whale_myr</code></td>
</tr>
<tr>
<td>SGD</td>
<td><code>blue_whale_sgd_monthly_summary</code></td>
<td><code>blue_whale_sgd</code></td>
</tr>
<tr>
<td>USC</td>
<td><code>blue_whale_usc_summary</code></td>
<td><code>blue_whale_usc</code></td>
</tr>
</tbody>
</table>
<p><strong>Month Column</strong>: INTEGER (1-12) di MV, VARCHAR
(January, February, …) di Master</p>
<h3 data-number="1.6.5" id="client-side-implementation"><span
class="header-section-number">1.6.5</span> 4.5 Client-Side
Implementation</h3>
<div class="sourceCode" id="cb6"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">// State management</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> [slicerOptions<span class="op">,</span> setSlicerOptions] <span class="op">=</span> <span class="fu">useState</span><span class="op">&lt;</span>SlicerOptions <span class="op">|</span> <span class="dt">null</span><span class="op">&gt;</span>(<span class="kw">null</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> [selectedYear<span class="op">,</span> setSelectedYear] <span class="op">=</span> <span class="fu">useState</span>(<span class="st">&#39;&#39;</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> [selectedMonth<span class="op">,</span> setSelectedMonth] <span class="op">=</span> <span class="fu">useState</span>(<span class="st">&#39;&#39;</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> [selectedLine<span class="op">,</span> setSelectedLine] <span class="op">=</span> <span class="fu">useState</span>(<span class="st">&#39;&#39;</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Load slicer options on mount</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="fu">useEffect</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> loadSlicerOptions <span class="op">=</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Get user&#39;s allowed brands from localStorage</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> userStr <span class="op">=</span> localStorage<span class="op">.</span><span class="fu">getItem</span>(<span class="st">&#39;nexmax_user&#39;</span>)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> allowedBrands <span class="op">=</span> userStr <span class="op">?</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">parse</span>(userStr)<span class="op">.</span><span class="at">allowed_brands</span> <span class="op">:</span> <span class="kw">null</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(<span class="st">&#39;/api/myr-overview/slicer-options&#39;</span><span class="op">,</span> {</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>        headers<span class="op">:</span> {</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;x-user-allowed-brands&#39;</span><span class="op">:</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(allowedBrands)</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>        cache<span class="op">:</span> <span class="st">&#39;no-store&#39;</span>  <span class="co">// Prevent caching</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> result <span class="op">=</span> <span class="cf">await</span> response<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (result<span class="op">.</span><span class="at">success</span>) {</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">setSlicerOptions</span>(result<span class="op">.</span><span class="at">data</span>)</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Auto-set to defaults from API</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">setSelectedYear</span>(result<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="at">defaults</span><span class="op">.</span><span class="at">year</span>)</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">setSelectedMonth</span>(result<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="at">defaults</span><span class="op">.</span><span class="at">month</span>)</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">setSelectedLine</span>(result<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="at">defaults</span><span class="op">.</span><span class="at">line</span>)</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">catch</span> (error) {</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">error</span>(<span class="st">&#39;Error loading slicer options:&#39;</span><span class="op">,</span> error)</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">loadSlicerOptions</span>()</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span> [])</span></code></pre></div>
<h3 data-number="1.6.6" id="subheader-slicer-ui"><span
class="header-section-number">1.6.6</span> 4.6 SubHeader Slicer UI</h3>
<div class="sourceCode" id="cb7"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> customSubHeader <span class="op">=</span> (</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="op">&lt;</span>div className<span class="op">=</span><span class="st">&quot;dashboard-subheader&quot;</span><span class="op">&gt;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span>div className<span class="op">=</span><span class="st">&quot;subheader-controls&quot;</span><span class="op">&gt;</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>      {<span class="co">/* YEAR SLICER */</span>}</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>      <span class="op">&lt;</span>div className<span class="op">=</span><span class="st">&quot;slicer-group&quot;</span><span class="op">&gt;</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">&lt;</span>label className<span class="op">=</span><span class="st">&quot;slicer-label&quot;</span><span class="op">&gt;</span>YEAR<span class="op">:&lt;/</span>label<span class="op">&gt;</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">&lt;</span>select</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>          value<span class="op">=</span>{selectedYear} </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>          onChange<span class="op">=</span>{(e) <span class="kw">=&gt;</span> <span class="fu">setSelectedYear</span>(e<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">value</span>)}</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>          className<span class="op">=</span><span class="st">&quot;subheader-select&quot;</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>          style<span class="op">=</span>{{</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>            padding<span class="op">:</span> <span class="st">&#39;8px 12px&#39;</span><span class="op">,</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>            border<span class="op">:</span> <span class="st">&#39;1px solid #e5e7eb&#39;</span><span class="op">,</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>            borderRadius<span class="op">:</span> <span class="st">&#39;8px&#39;</span><span class="op">,</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>            backgroundColor<span class="op">:</span> <span class="st">&#39;white&#39;</span><span class="op">,</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>            fontSize<span class="op">:</span> <span class="st">&#39;14px&#39;</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>          }}</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">&gt;</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>          {slicerOptions<span class="op">?.</span><span class="at">years</span><span class="op">?.</span><span class="fu">map</span>((year<span class="op">:</span> <span class="dt">string</span>) <span class="kw">=&gt;</span> (</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>            <span class="op">&lt;</span>option key<span class="op">=</span>{year} value<span class="op">=</span>{year}<span class="op">&gt;</span>{year}<span class="op">&lt;/</span>option<span class="op">&gt;</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>          ))}</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>        <span class="op">&lt;/</span>select<span class="op">&gt;</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>      <span class="op">&lt;/</span>div<span class="op">&gt;</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>      {<span class="co">/* MONTH SLICER with DYNAMIC filtering */</span>}</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>      <span class="op">&lt;</span>div className<span class="op">=</span><span class="st">&quot;slicer-group&quot;</span><span class="op">&gt;</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>        <span class="op">&lt;</span>label className<span class="op">=</span><span class="st">&quot;slicer-label&quot;</span><span class="op">&gt;</span>MONTH<span class="op">:&lt;/</span>label<span class="op">&gt;</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>        <span class="op">&lt;</span>select</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>          value<span class="op">=</span>{selectedMonth} </span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>          onChange<span class="op">=</span>{(e) <span class="kw">=&gt;</span> <span class="fu">setSelectedMonth</span>(e<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">value</span>)}</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>          className<span class="op">=</span><span class="st">&quot;subheader-select&quot;</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>        <span class="op">&gt;</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>          {slicerOptions<span class="op">?.</span><span class="at">months</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>            <span class="op">?.</span><span class="fu">filter</span>((month<span class="op">:</span> <span class="dt">any</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>              <span class="cf">if</span> (month<span class="op">.</span><span class="at">value</span> <span class="op">===</span> <span class="st">&#39;ALL&#39;</span>) <span class="cf">return</span> <span class="kw">true</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>              <span class="cf">return</span> month<span class="op">.</span><span class="at">years</span> <span class="op">&amp;&amp;</span> month<span class="op">.</span><span class="at">years</span><span class="op">.</span><span class="fu">includes</span>(selectedYear)</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>            })</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>            <span class="op">?.</span><span class="fu">map</span>((month<span class="op">:</span> <span class="dt">any</span>) <span class="kw">=&gt;</span> (</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>              <span class="op">&lt;</span>option key<span class="op">=</span>{month<span class="op">.</span><span class="at">value</span>} value<span class="op">=</span>{month<span class="op">.</span><span class="at">value</span>}<span class="op">&gt;</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>                {month<span class="op">.</span><span class="at">label</span>}</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>              <span class="op">&lt;/</span>option<span class="op">&gt;</span></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>            ))}</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>        <span class="op">&lt;/</span>select<span class="op">&gt;</span></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>      <span class="op">&lt;/</span>div<span class="op">&gt;</span></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>      {<span class="co">/* LINE SLICER */</span>}</span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>      <span class="op">&lt;</span>div className<span class="op">=</span><span class="st">&quot;slicer-group&quot;</span><span class="op">&gt;</span></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>        <span class="op">&lt;</span>label className<span class="op">=</span><span class="st">&quot;slicer-label&quot;</span><span class="op">&gt;</span>LINE<span class="op">:&lt;/</span>label<span class="op">&gt;</span></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>        <span class="op">&lt;</span>LineSlicer </span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>          lines<span class="op">=</span>{slicerOptions<span class="op">?.</span><span class="at">lines</span> <span class="op">||</span> []}</span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>          selectedLine<span class="op">=</span>{selectedLine}</span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>          onLineChange<span class="op">=</span>{setSelectedLine}</span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>        <span class="op">/&gt;</span></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>      <span class="op">&lt;/</span>div<span class="op">&gt;</span></span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;/</span>div<span class="op">&gt;</span></span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>  <span class="op">&lt;/</span>div<span class="op">&gt;</span></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><strong>âœ… KEY POINTS</strong>: - âœ… API auto-fetch dari database
(NO hardcoded values) - âœ… Month slicer dengan DYNAMIC year filtering -
âœ… Currency lock untuk page spesifik (MYR/SGD/USC) - âœ… Default values
dari latest record (max date dari database) - âœ… Brand filtering untuk
Squad Lead (NEW - Nov 2025) - âœ… Permission check di server-side (NEW -
Nov 2025)</p>
<hr />
<h2 data-number="1.7" id="data-api-patterns"><span
class="header-section-number">1.7</span> 5. DATA API PATTERNS</h2>
<h3 data-number="1.7.1" id="standard-query-pattern"><span
class="header-section-number">1.7.1</span> 5.1 Standard Query
Pattern</h3>
<p><strong>ALL Markets</strong> menggunakan pattern yang sama:</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">async</span> <span class="kw">function</span> <span class="fu">GET</span>(request<span class="op">:</span> NextRequest) {</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> line <span class="op">=</span> searchParams<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;line&#39;</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> year <span class="op">=</span> searchParams<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;year&#39;</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> month <span class="op">=</span> searchParams<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;month&#39;</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Get user&#39;s allowed brands</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> userAllowedBrandsHeader <span class="op">=</span> request<span class="op">.</span><span class="at">headers</span><span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;x-user-allowed-brands&#39;</span>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> userAllowedBrands <span class="op">=</span> userAllowedBrandsHeader <span class="op">?</span> </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">JSON</span><span class="op">.</span><span class="fu">parse</span>(userAllowedBrandsHeader) <span class="op">:</span> <span class="kw">null</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Build query with brand filtering</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> query <span class="op">=</span> supabase</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">from</span>(<span class="st">&#39;blue_whale_myr&#39;</span>)  <span class="co">// Change per currency</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;*&#39;</span>)</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">eq</span>(<span class="st">&#39;currency&#39;</span><span class="op">,</span> <span class="st">&#39;MYR&#39;</span>)  <span class="co">// Lock currency</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Apply brand filter with permission check</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (line <span class="op">&amp;&amp;</span> line <span class="op">!==</span> <span class="st">&#39;ALL&#39;</span>) {</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (userAllowedBrands <span class="op">&amp;&amp;</span> <span class="op">!</span>userAllowedBrands<span class="op">.</span><span class="fu">includes</span>(line)) {</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> NextResponse<span class="op">.</span><span class="fu">json</span>({</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>        success<span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>        error<span class="op">:</span> <span class="st">&#39;Unauthorized&#39;</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span> { status<span class="op">:</span> <span class="dv">403</span> })</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>    query <span class="op">=</span> query<span class="op">.</span><span class="fu">eq</span>(<span class="st">&#39;line&#39;</span><span class="op">,</span> line)</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (line <span class="op">===</span> <span class="st">&#39;ALL&#39;</span> <span class="op">&amp;&amp;</span> userAllowedBrands) {</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>    query <span class="op">=</span> query<span class="op">.</span><span class="fu">in</span>(<span class="st">&#39;line&#39;</span><span class="op">,</span> userAllowedBrands)</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (year <span class="op">&amp;&amp;</span> year <span class="op">!==</span> <span class="st">&#39;ALL&#39;</span>) query <span class="op">=</span> query<span class="op">.</span><span class="fu">eq</span>(<span class="st">&#39;year&#39;</span><span class="op">,</span> <span class="pp">parseInt</span>(year))</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (month <span class="op">&amp;&amp;</span> month <span class="op">!==</span> <span class="st">&#39;ALL&#39;</span>) query <span class="op">=</span> query<span class="op">.</span><span class="fu">eq</span>(<span class="st">&#39;month&#39;</span><span class="op">,</span> month)</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> { data<span class="op">,</span> error } <span class="op">=</span> <span class="cf">await</span> query</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> NextResponse<span class="op">.</span><span class="fu">json</span>({</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>    success<span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>    data<span class="op">:</span> processedData</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<hr />
<h2 data-number="1.8" id="export-api-standard"><span
class="header-section-number">1.8</span> 6. EXPORT API STANDARD</h2>
<h3 data-number="1.8.1" id="pattern-all-markets"><span
class="header-section-number">1.8.1</span> 6.1 Pattern (ALL
Markets)</h3>
<p><strong>Method</strong>: POST <strong>Response</strong>: CSV file
download</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">async</span> <span class="kw">function</span> <span class="fu">POST</span>(request<span class="op">:</span> NextRequest) {</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> { line<span class="op">,</span> year<span class="op">,</span> month<span class="op">,</span> statusFilter } <span class="op">=</span> <span class="cf">await</span> request<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Fetch and process data (SAME logic as display)</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> processedData <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetchAndProcess</span>(line<span class="op">,</span> year<span class="op">,</span> month)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Apply filters (server-side)</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> filteredData <span class="op">=</span> <span class="fu">applyFilters</span>(processedData<span class="op">,</span> statusFilter)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Convert to CSV</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> csvContent <span class="op">=</span> <span class="fu">generateCSV</span>(filteredData)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Add BOM for Excel UTF-8 compatibility</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> csvWithBOM <span class="op">=</span> <span class="st">&#39;</span><span class="sc">\ufeff</span><span class="st">&#39;</span> <span class="op">+</span> csvContent</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Return with proper headers</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="kw">new</span> <span class="fu">NextResponse</span>(csvWithBOM<span class="op">,</span> {</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    headers<span class="op">:</span> {</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;Content-Type&#39;</span><span class="op">:</span> <span class="st">&#39;text/csv; charset=utf-8&#39;</span><span class="op">,</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;Content-Disposition&#39;</span><span class="op">:</span> <span class="vs">`attachment; filename=&quot;export_</span><span class="sc">${</span>timestamp<span class="sc">}</span><span class="vs">.csv&quot;`</span><span class="op">,</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;Cache-Control&#39;</span><span class="op">:</span> <span class="st">&#39;no-cache&#39;</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<hr />
<h2 data-number="1.9" id="daily-average-logic"><span
class="header-section-number">1.9</span> 7. DAILY AVERAGE LOGIC</h2>
<h3 data-number="1.9.1" id="overview-1"><span
class="header-section-number">1.9.1</span> 7.1 Overview</h3>
<p>Daily Average = <strong>Monthly Value Ã· Active Days</strong></p>
<p><strong>Logic Files</strong>: - MYR:
<code>lib/MYRDailyAverageAndMoM.ts</code> atau
<code>lib/MYRDailyAverageAndMoM_clean.ts</code> - SGD:
<code>lib/SGDDailyAverageAndMoM.ts</code> - USC:
<code>lib/USCDailyAverageAndMoM.ts</code></p>
<h3 data-number="1.9.2"
id="core-logic-universal-untuk-all-markets"><span
class="header-section-number">1.9.2</span> 7.2 Core Logic (Universal
untuk ALL Markets)</h3>
<div class="sourceCode" id="cb10"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"> * Get current month progress (days elapsed so far)</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="kw">async</span> <span class="kw">function</span> <span class="fu">getCurrentMonthProgress</span>(year<span class="op">:</span> <span class="dt">string</span><span class="op">,</span> month<span class="op">:</span> <span class="dt">string</span>)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">number</span><span class="op">&gt;</span> {</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> currentDate <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>()</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> currentYear <span class="op">=</span> currentDate<span class="op">.</span><span class="fu">getFullYear</span>()<span class="op">.</span><span class="fu">toString</span>()</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> currentMonth <span class="op">=</span> <span class="fu">getMonthName</span>(currentDate<span class="op">.</span><span class="fu">getMonth</span>())</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Only use database for CURRENT ongoing month</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (year <span class="op">===</span> currentYear <span class="op">&amp;&amp;</span> month <span class="op">===</span> currentMonth) {</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="vs">`ðŸ“… [Daily Average] CURRENT ongoing month detected`</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> lastUpdateDay <span class="op">=</span> <span class="cf">await</span> <span class="fu">getLastUpdateDateFromDatabase</span>(year<span class="op">,</span> month)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> currentDay <span class="op">=</span> currentDate<span class="op">.</span><span class="fu">getDate</span>()</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> activeDays <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(lastUpdateDay<span class="op">,</span> currentDay)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> activeDays</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">// For ALL past months, use total days</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> totalDays <span class="op">=</span> <span class="fu">getDaysInMonth</span>(year<span class="op">,</span> month)</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> totalDays</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a><span class="co"> * Calculate daily average</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="kw">async</span> <span class="kw">function</span> <span class="fu">calculateDailyAverage</span>(</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>  monthlyValue<span class="op">:</span> <span class="dt">number</span><span class="op">,</span> </span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>  year<span class="op">:</span> <span class="dt">string</span><span class="op">,</span> </span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>  month<span class="op">:</span> <span class="dt">string</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">number</span><span class="op">&gt;</span> {</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> activeDays <span class="op">=</span> <span class="cf">await</span> <span class="fu">getCurrentMonthProgress</span>(year<span class="op">,</span> month)</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (activeDays <span class="op">===</span> <span class="dv">0</span> <span class="op">||</span> activeDays <span class="op">&lt;</span> <span class="dv">1</span>) {</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> fallbackDays <span class="op">=</span> <span class="fu">getDaysInMonth</span>(year<span class="op">,</span> month)</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> monthlyValue <span class="op">/</span> fallbackDays</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> monthlyValue <span class="op">/</span> activeDays</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 data-number="1.9.3" id="usage-in-page-all-markets"><span
class="header-section-number">1.9.3</span> 7.3 Usage in Page (ALL
Markets)</h3>
<div class="sourceCode" id="cb11"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Load KPI data with Daily Average - UNIVERSAL PATTERN</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">useEffect</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>selectedYear <span class="op">||</span> <span class="op">!</span>selectedMonth <span class="op">||</span> <span class="op">!</span>selectedLine) <span class="cf">return</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> loadKPIData <span class="op">=</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// MYR: getAllMYRKPIsWithMoM()</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// SGD: getAllSGDKPIsWithMoM()</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// USC: getAllUSCKPIsWithMoM()</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> result <span class="op">=</span> <span class="cf">await</span> <span class="fu">getAllMYRKPIsWithMoM</span>(</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>      selectedYear<span class="op">,</span> </span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>      selectedMonth<span class="op">,</span> </span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>      selectedLine <span class="op">===</span> <span class="st">&#39;ALL&#39;</span> <span class="op">?</span> <span class="kw">undefined</span> <span class="op">:</span> selectedLine</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setKpiData</span>(result<span class="op">.</span><span class="at">current</span>)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setMomData</span>(result<span class="op">.</span><span class="at">mom</span>)</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setDailyAverages</span>(result<span class="op">.</span><span class="at">dailyAverage</span>)</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">loadKPIData</span>()</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span> [selectedYear<span class="op">,</span> selectedMonth<span class="op">,</span> selectedLine])</span></code></pre></div>
<p><strong>âœ… KEY POINTS</strong>: - âœ… Current month: use database
last update date - âœ… Past months: use total days in month - âœ…
Handles leap years automatically - âœ… Returns all KPIs daily average -
âœ… Same logic untuk MYR, SGD, USC (hanya table name berbeda)</p>
<hr />
<h2 data-number="1.10" id="month-over-month-mom-comparison"><span
class="header-section-number">1.10</span> 8. MONTH-OVER-MONTH (MOM)
COMPARISON</h2>
<h3 data-number="1.10.1" id="overview-2"><span
class="header-section-number">1.10.1</span> 8.1 Overview</h3>
<p>MoM = <code>((Current - Previous) / Previous) Ã— 100%</code></p>
<p><strong>Logic Files</strong>: Same dengan Daily Average logic files -
MYR: <code>lib/MYRDailyAverageAndMoM.ts</code> - SGD:
<code>lib/SGDDailyAverageAndMoM.ts</code> - USC:
<code>lib/USCDailyAverageAndMoM.ts</code></p>
<h3 data-number="1.10.2" id="core-logic-universal"><span
class="header-section-number">1.10.2</span> 8.2 Core Logic
(Universal)</h3>
<div class="sourceCode" id="cb12"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"> * Calculate MoM percentage change</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">calculateMoM</span>(current<span class="op">:</span> <span class="dt">number</span><span class="op">,</span> previous<span class="op">:</span> <span class="dt">number</span>)<span class="op">:</span> <span class="dt">number</span> {</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (previous <span class="op">===</span> <span class="dv">0</span>) <span class="cf">return</span> current <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> <span class="dv">100</span> <span class="op">:</span> <span class="dv">0</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> ((current <span class="op">-</span> previous) <span class="op">/</span> previous) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co"> * Get ALL KPIs with MoM - UNIVERSAL FUNCTION</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co"> * Available for: getAllMYRKPIsWithMoM, getAllSGDKPIsWithMoM, getAllUSCKPIsWithMoM</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">async</span> <span class="kw">function</span> <span class="fu">getAllKPIsWithMoM</span>(</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  year<span class="op">:</span> <span class="dt">string</span><span class="op">,</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  month<span class="op">:</span> <span class="dt">string</span><span class="op">,</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  line<span class="op">?:</span> <span class="dt">string</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span>{ current<span class="op">:</span> KPIData<span class="op">,</span> mom<span class="op">:</span> MoMData<span class="op">,</span> dailyAverage<span class="op">:</span> KPIData }<span class="op">&gt;</span> {</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Get current month data</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> currentData <span class="op">=</span> <span class="cf">await</span> <span class="fu">getKPIData</span>(year<span class="op">,</span> month<span class="op">,</span> line)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Get previous month data (auto-calculate prev month)</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> { year<span class="op">:</span> prevYear<span class="op">,</span> month<span class="op">:</span> prevMonth } <span class="op">=</span> <span class="fu">getPreviousMonth</span>(year<span class="op">,</span> month)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> previousData <span class="op">=</span> <span class="cf">await</span> <span class="fu">getKPIData</span>(prevYear<span class="op">,</span> prevMonth<span class="op">,</span> line)</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Calculate MoM for ALL KPIs</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> mom <span class="op">=</span> {</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    activeMember<span class="op">:</span> <span class="fu">calculateMoM</span>(currentData<span class="op">.</span><span class="at">activeMember</span><span class="op">,</span> previousData<span class="op">.</span><span class="at">activeMember</span>)<span class="op">,</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>    depositAmount<span class="op">:</span> <span class="fu">calculateMoM</span>(currentData<span class="op">.</span><span class="at">depositAmount</span><span class="op">,</span> previousData<span class="op">.</span><span class="at">depositAmount</span>)<span class="op">,</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>    netProfit<span class="op">:</span> <span class="fu">calculateMoM</span>(currentData<span class="op">.</span><span class="at">netProfit</span><span class="op">,</span> previousData<span class="op">.</span><span class="at">netProfit</span>)<span class="op">,</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ... all 55+ KPIs</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Calculate daily averages for ALL KPIs</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dailyAverage <span class="op">=</span> <span class="cf">await</span> <span class="fu">calculateAllDailyAverages</span>(currentData<span class="op">,</span> year<span class="op">,</span> month)</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> { current<span class="op">:</span> currentData<span class="op">,</span> mom<span class="op">,</span> dailyAverage }</span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 data-number="1.10.3" id="previous-month-calculation"><span
class="header-section-number">1.10.3</span> 8.3 Previous Month
Calculation</h3>
<div class="sourceCode" id="cb13"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"> * Handle year boundary (Dec â†’ Jan)</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">getPreviousMonth</span>(year<span class="op">:</span> <span class="dt">string</span><span class="op">,</span> month<span class="op">:</span> <span class="dt">string</span>)<span class="op">:</span> { year<span class="op">:</span> <span class="dt">string</span><span class="op">,</span> month<span class="op">:</span> <span class="dt">string</span> } {</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> monthNames <span class="op">=</span> [<span class="st">&#39;January&#39;</span><span class="op">,</span> <span class="st">&#39;February&#39;</span><span class="op">,</span> <span class="st">&#39;March&#39;</span><span class="op">,</span> <span class="st">&#39;April&#39;</span><span class="op">,</span> <span class="st">&#39;May&#39;</span><span class="op">,</span> <span class="st">&#39;June&#39;</span><span class="op">,</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&#39;July&#39;</span><span class="op">,</span> <span class="st">&#39;August&#39;</span><span class="op">,</span> <span class="st">&#39;September&#39;</span><span class="op">,</span> <span class="st">&#39;October&#39;</span><span class="op">,</span> <span class="st">&#39;November&#39;</span><span class="op">,</span> <span class="st">&#39;December&#39;</span>]</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> currentMonthIndex <span class="op">=</span> monthNames<span class="op">.</span><span class="fu">indexOf</span>(month)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> prevMonthIndex <span class="op">=</span> currentMonthIndex <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> <span class="dv">11</span> <span class="op">:</span> currentMonthIndex <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> prevMonth <span class="op">=</span> monthNames[prevMonthIndex]</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> prevYear <span class="op">=</span> currentMonthIndex <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> (<span class="pp">parseInt</span>(year) <span class="op">-</span> <span class="dv">1</span>)<span class="op">.</span><span class="fu">toString</span>() <span class="op">:</span> year</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> { year<span class="op">:</span> prevYear<span class="op">,</span> month<span class="op">:</span> prevMonth }</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 data-number="1.10.4" id="format-mom-display"><span
class="header-section-number">1.10.4</span> 8.4 Format MoM Display</h3>
<div class="sourceCode" id="cb14"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Format MoM value with sign</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">function</span> <span class="fu">formatMoMChange</span>(value<span class="op">:</span> <span class="dt">number</span>)<span class="op">:</span> <span class="dt">string</span> {</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> sign <span class="op">=</span> value <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> <span class="st">&#39;+&#39;</span> <span class="op">:</span> <span class="st">&#39;&#39;</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="vs">`</span><span class="sc">${</span>sign<span class="sc">}${</span>value<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs">%`</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Get MoM color</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">function</span> <span class="fu">getMoMColor</span>(value<span class="op">:</span> <span class="dt">number</span>)<span class="op">:</span> <span class="dt">string</span> {</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> value <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> <span class="st">&#39;#059669&#39;</span> <span class="op">:</span> value <span class="op">&lt;</span> <span class="dv">0</span> <span class="op">?</span> <span class="st">&#39;#dc2626&#39;</span> <span class="op">:</span> <span class="st">&#39;#6b7280&#39;</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>âœ… KEY POINTS</strong>: - âœ… Automatic previous month
calculation (handles year boundary) - âœ… Handles division by zero - âœ…
Returns positive/negative with color coding - âœ… All KPIs MoM in one
call - âœ… Same logic untuk MYR, SGD, USC</p>
<hr />
<h2 data-number="1.11" id="kpi-calculation-logic"><span
class="header-section-number">1.11</span> 9. KPI CALCULATION LOGIC</h2>
<h3 data-number="1.11.1" id="logic-files-by-currency"><span
class="header-section-number">1.11.1</span> 9.1 Logic Files by
Currency</h3>
<table>
<thead>
<tr>
<th>Currency</th>
<th>Main Logic File</th>
<th>Line Count</th>
</tr>
</thead>
<tbody>
<tr>
<td>MYR</td>
<td><code>lib/MYRDailyAverageAndMoM_clean.ts</code></td>
<td>474 lines</td>
</tr>
<tr>
<td>SGD</td>
<td><code>lib/SGDDailyAverageAndMoM.ts</code></td>
<td>~400 lines</td>
</tr>
<tr>
<td>USC</td>
<td><code>lib/USCLogic.ts</code></td>
<td>916 lines</td>
</tr>
</tbody>
</table>
<h3 data-number="1.11.2"
id="usc-formulas-reference---apply-same-untuk-myrsgd"><span
class="header-section-number">1.11.2</span> 9.2 USC Formulas (Reference
- Apply Same untuk MYR/SGD)</h3>
<p><strong>File</strong>: <code>lib/USCLogic.ts</code></p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">const</span> USC_KPI_FORMULAS <span class="op">=</span> {</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// GGR per User</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  GGR_USER<span class="op">:</span> (data) <span class="kw">=&gt;</span> {</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> data<span class="op">.</span><span class="at">deposit</span><span class="op">.</span><span class="at">active_members</span> <span class="op">&gt;</span> <span class="dv">0</span> </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>      <span class="op">?</span> data<span class="op">.</span><span class="at">member</span><span class="op">.</span><span class="at">net_profit</span> <span class="op">/</span> data<span class="op">.</span><span class="at">deposit</span><span class="op">.</span><span class="at">active_members</span> </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> <span class="dv">0</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Pure Member</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  PURE_MEMBER<span class="op">:</span> (data) <span class="kw">=&gt;</span> {</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(data<span class="op">.</span><span class="at">deposit</span><span class="op">.</span><span class="at">active_members</span> <span class="op">-</span> data<span class="op">.</span><span class="at">newDepositor</span><span class="op">.</span><span class="at">new_depositor</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">// GGR per Pure User</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  GGR_PURE_USER<span class="op">:</span> (data) <span class="kw">=&gt;</span> {</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> pureMember <span class="op">=</span> USC_KPI_FORMULAS<span class="op">.</span><span class="fu">PURE_MEMBER</span>(data)</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pureMember <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> data<span class="op">.</span><span class="at">member</span><span class="op">.</span><span class="at">ggr</span> <span class="op">/</span> pureMember <span class="op">:</span> <span class="dv">0</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Winrate</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>  WINRATE<span class="op">:</span> (data) <span class="kw">=&gt;</span> {</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> data<span class="op">.</span><span class="at">deposit</span><span class="op">.</span><span class="at">deposit_amount</span> <span class="op">&gt;</span> <span class="dv">0</span> </span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>      <span class="op">?</span> (data<span class="op">.</span><span class="at">member</span><span class="op">.</span><span class="at">ggr</span> <span class="op">/</span> data<span class="op">.</span><span class="at">deposit</span><span class="op">.</span><span class="at">deposit_amount</span>) <span class="op">*</span> <span class="dv">100</span> </span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> <span class="dv">0</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Average Transaction Value</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>  AVG_TRANSACTION_VALUE<span class="op">:</span> (data) <span class="kw">=&gt;</span> {</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> data<span class="op">.</span><span class="at">deposit</span><span class="op">.</span><span class="at">deposit_cases</span> <span class="op">&gt;</span> <span class="dv">0</span> </span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>      <span class="op">?</span> data<span class="op">.</span><span class="at">deposit</span><span class="op">.</span><span class="at">deposit_amount</span> <span class="op">/</span> data<span class="op">.</span><span class="at">deposit</span><span class="op">.</span><span class="at">deposit_cases</span> </span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> <span class="dv">0</span></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Purchase Frequency</span></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>  PURCHASE_FREQUENCY<span class="op">:</span> (data) <span class="kw">=&gt;</span> {</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> data<span class="op">.</span><span class="at">deposit</span><span class="op">.</span><span class="at">active_members</span> <span class="op">&gt;</span> <span class="dv">0</span> </span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>      <span class="op">?</span> data<span class="op">.</span><span class="at">deposit</span><span class="op">.</span><span class="at">deposit_cases</span> <span class="op">/</span> data<span class="op">.</span><span class="at">deposit</span><span class="op">.</span><span class="at">active_members</span> </span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> <span class="dv">0</span></span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Churn Rate</span></span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>  CHURN_RATE<span class="op">:</span> (data) <span class="kw">=&gt;</span> {</span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> data<span class="op">.</span><span class="at">churn</span><span class="op">.</span><span class="at">last_month_active_members</span> <span class="op">&gt;</span> <span class="dv">0</span> </span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>      <span class="op">?</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>((data<span class="op">.</span><span class="at">churn</span><span class="op">.</span><span class="at">churn_members</span> <span class="op">/</span> data<span class="op">.</span><span class="at">churn</span><span class="op">.</span><span class="at">last_month_active_members</span>)<span class="op">,</span> <span class="fl">0.01</span>) <span class="op">*</span> <span class="dv">100</span> </span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> <span class="dv">1</span></span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Retention Rate</span></span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>  RETENTION_RATE<span class="op">:</span> (churnRate) <span class="kw">=&gt;</span> {</span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">1</span> <span class="op">-</span> (churnRate <span class="op">/</span> <span class="dv">100</span>)<span class="op">,</span> <span class="dv">0</span>) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Avg Customer Lifespan</span></span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a>  AVG_CUSTOMER_LIFESPAN<span class="op">:</span> (churnRate) <span class="kw">=&gt;</span> {</span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> churnRateDecimal <span class="op">=</span> churnRate <span class="op">/</span> <span class="dv">100</span></span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> churnRateDecimal <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> (<span class="dv">1</span> <span class="op">/</span> churnRateDecimal) <span class="op">:</span> <span class="dv">1000</span></span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Customer Lifetime Value</span></span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a>  CUSTOMER_LIFETIME_VALUE<span class="op">:</span> (atv<span class="op">,</span> pf<span class="op">,</span> acl) <span class="kw">=&gt;</span> {</span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> atv <span class="op">*</span> pf <span class="op">*</span> acl</span>
<span id="cb15-62"><a href="#cb15-62" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb15-63"><a href="#cb15-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-64"><a href="#cb15-64" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Customer Maturity Index</span></span>
<span id="cb15-65"><a href="#cb15-65" aria-hidden="true" tabindex="-1"></a>  CUSTOMER_MATURITY_INDEX<span class="op">:</span> (retentionRate<span class="op">,</span> growthRate<span class="op">,</span> churnRate) <span class="kw">=&gt;</span> {</span>
<span id="cb15-66"><a href="#cb15-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (retentionRate <span class="op">*</span> <span class="fl">0.5</span>) <span class="op">+</span> (growthRate <span class="op">*</span> <span class="fl">0.5</span>) <span class="op">+</span> (churnRate <span class="op">*</span> <span class="fl">0.2</span>)</span>
<span id="cb15-67"><a href="#cb15-67" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb15-68"><a href="#cb15-68" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-69"><a href="#cb15-69" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Conversion Rate</span></span>
<span id="cb15-70"><a href="#cb15-70" aria-hidden="true" tabindex="-1"></a>  NEW_CUSTOMER_CONVERSION_RATE<span class="op">:</span> (data) <span class="kw">=&gt;</span> {</span>
<span id="cb15-71"><a href="#cb15-71" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> data<span class="op">.</span><span class="at">newRegister</span><span class="op">.</span><span class="at">new_register</span> <span class="op">&gt;</span> <span class="dv">0</span> </span>
<span id="cb15-72"><a href="#cb15-72" aria-hidden="true" tabindex="-1"></a>      <span class="op">?</span> (data<span class="op">.</span><span class="at">newDepositor</span><span class="op">.</span><span class="at">new_depositor</span> <span class="op">/</span> data<span class="op">.</span><span class="at">newRegister</span><span class="op">.</span><span class="at">new_register</span>) <span class="op">*</span> <span class="dv">100</span> </span>
<span id="cb15-73"><a href="#cb15-73" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> <span class="dv">0</span></span>
<span id="cb15-74"><a href="#cb15-74" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb15-75"><a href="#cb15-75" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-76"><a href="#cb15-76" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Hold Percentage</span></span>
<span id="cb15-77"><a href="#cb15-77" aria-hidden="true" tabindex="-1"></a>  HOLD_PERCENTAGE<span class="op">:</span> (netProfit<span class="op">,</span> validAmount) <span class="kw">=&gt;</span> {</span>
<span id="cb15-78"><a href="#cb15-78" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> validAmount <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> (netProfit <span class="op">/</span> validAmount) <span class="op">*</span> <span class="dv">100</span> <span class="op">:</span> <span class="dv">0</span></span>
<span id="cb15-79"><a href="#cb15-79" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-80"><a href="#cb15-80" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 data-number="1.11.3"
id="hybrid-data-fetching-usc-pattern---apply-to-all"><span
class="header-section-number">1.11.3</span> 9.3 Hybrid Data Fetching
(USC Pattern - Apply to ALL)</h3>
<div class="sourceCode" id="cb16"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">async</span> <span class="kw">function</span> <span class="fu">getUSCRawKPIData</span>(filters) {</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// PARALLEL FETCH from Master + MV</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> [activeMemberResult<span class="op">,</span> summaryDataResult<span class="op">,</span> churnResult] <span class="op">=</span> <span class="cf">await</span> <span class="bu">Promise</span><span class="op">.</span><span class="fu">all</span>([</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 1. Active Member &amp; Pure User from MASTER (precision)</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    supabase</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">from</span>(<span class="st">&#39;blue_whale_usc&#39;</span>)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;userkey, unique_code&#39;</span>)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">eq</span>(<span class="st">&#39;year&#39;</span><span class="op">,</span> filters<span class="op">.</span><span class="at">year</span>)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">eq</span>(<span class="st">&#39;month&#39;</span><span class="op">,</span> filters<span class="op">.</span><span class="at">month</span>)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">gt</span>(<span class="st">&#39;deposit_cases&#39;</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">,</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 2. Amounts &amp; Cases from MV (performance)</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    supabase</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">from</span>(<span class="st">&#39;blue_whale_usc_summary&#39;</span>)</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;deposit_amount, withdraw_amount, deposit_cases, ...&#39;</span>)</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">eq</span>(<span class="st">&#39;year&#39;</span><span class="op">,</span> filters<span class="op">.</span><span class="at">year</span>)</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">eq</span>(<span class="st">&#39;month&#39;</span><span class="op">,</span> filters<span class="op">.</span><span class="at">month</span>)<span class="op">,</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 3. Churn from MASTER (precision)</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">getUSCChurnMembers</span>(filters)</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>  ])</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Aggregate results</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> activeMember <span class="op">=</span> <span class="fu">COUNT_DISTINCT</span>(activeMemberResult<span class="op">.</span><span class="at">data</span><span class="op">,</span> <span class="st">&#39;userkey&#39;</span>)</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> pureUser <span class="op">=</span> <span class="fu">COUNT_DISTINCT</span>(activeMemberResult<span class="op">.</span><span class="at">data</span><span class="op">,</span> <span class="st">&#39;unique_code&#39;</span>)</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> amounts <span class="op">=</span> <span class="fu">SUM</span>(summaryDataResult<span class="op">.</span><span class="at">data</span>)</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> { activeMember<span class="op">,</span> pureUser<span class="op">,</span> <span class="op">...</span>amounts<span class="op">,</span> <span class="op">...</span>churnResult }</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<hr />
<h2 data-number="1.12" id="statcard-standard"><span
class="header-section-number">1.12</span> 10. STATCARD STANDARD</h2>
<h3 data-number="1.12.1" id="overview-3"><span
class="header-section-number">1.12.1</span> 10.1 Overview</h3>
<p>StatCard adalah komponen standard untuk menampilkan KPI dengan
<strong>Daily Average</strong> dan <strong>MoM comparison</strong>.</p>
<p><strong>Component</strong>: <code>components/StatCard.tsx</code> (147
lines)</p>
<p><strong>Used in</strong>: ALL 42 pages</p>
<h3 data-number="1.12.2" id="statcard-structure"><span
class="header-section-number">1.12.2</span> 10.2 StatCard Structure</h3>
<div class="sourceCode" id="cb17"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>StatCard</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  title<span class="op">=</span><span class="st">&quot;DEPOSIT AMOUNT&quot;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  value<span class="op">=</span>{<span class="fu">formatCurrencyKPI</span>(kpiData<span class="op">?.</span><span class="at">depositAmount</span> <span class="op">||</span> <span class="dv">0</span><span class="op">,</span> selectedCurrency)}</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  icon<span class="op">=</span><span class="st">&quot;Deposit Amount&quot;</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  additionalKpi<span class="op">=</span>{{</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    label<span class="op">:</span> <span class="st">&quot;DAILY AVERAGE&quot;</span><span class="op">,</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    value<span class="op">:</span> <span class="fu">formatCurrencyKPI</span>(dailyAverages<span class="op">.</span><span class="at">depositAmount</span><span class="op">,</span> selectedCurrency)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  }}</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  comparison<span class="op">=</span>{{</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    percentage<span class="op">:</span> <span class="fu">formatMoMChange</span>(momData<span class="op">?.</span><span class="at">depositAmount</span> <span class="op">||</span> <span class="dv">0</span>)<span class="op">,</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    isPositive<span class="op">:</span> <span class="bu">Boolean</span>(momData<span class="op">?.</span><span class="at">depositAmount</span> <span class="op">&amp;&amp;</span> momData<span class="op">.</span><span class="at">depositAmount</span> <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  }}</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="op">/&gt;</span></span></code></pre></div>
<h3 data-number="1.12.3" id="props-interface"><span
class="header-section-number">1.12.3</span> 10.3 Props Interface</h3>
<div class="sourceCode" id="cb18"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> StatCardProps {</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  title<span class="op">:</span> <span class="dt">string</span>                    <span class="co">// KPI name (UPPERCASE recommended)</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  value<span class="op">:</span> <span class="dt">string</span> <span class="op">|</span> <span class="dt">number</span>           <span class="co">// Main value (formatted)</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  icon<span class="op">?:</span> <span class="dt">string</span>                    <span class="co">// Icon name dari CentralIcon</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  additionalKpi<span class="op">?:</span> {                <span class="co">// Daily Average / Secondary metric</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    label<span class="op">:</span> <span class="dt">string</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    value<span class="op">:</span> <span class="dt">string</span> <span class="op">|</span> <span class="dt">number</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    isPositive<span class="op">?:</span> <span class="dt">boolean</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  comparison<span class="op">?:</span> {                   <span class="co">// MoM comparison</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    percentage<span class="op">:</span> <span class="dt">string</span>             <span class="co">// &quot;+5.67%&quot; or &quot;-3.21%&quot;</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    isPositive<span class="op">:</span> <span class="dt">boolean</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    text<span class="op">?:</span> <span class="dt">string</span>                  <span class="co">// Default: &quot;MoM&quot;</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  onClick<span class="op">?:</span> () <span class="kw">=&gt;</span> <span class="dt">void</span>            <span class="co">// Drill-down handler</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>  clickable<span class="op">?:</span> <span class="dt">boolean</span>             <span class="co">// Enable click behavior</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 data-number="1.12.4" id="kpi-cards-grid-layout"><span
class="header-section-number">1.12.4</span> 10.4 6 KPI Cards Grid
Layout</h3>
<div class="sourceCode" id="cb19"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>{<span class="co">/* BARIS 1: KPI CARDS (STANDARD ROW) */</span>}</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>div className<span class="op">=</span><span class="st">&quot;kpi-row&quot;</span><span class="op">&gt;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">&lt;</span>StatCard title<span class="op">=</span><span class="st">&quot;DEPOSIT AMOUNT&quot;</span> <span class="op">...</span> <span class="op">/&gt;</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">&lt;</span>StatCard title<span class="op">=</span><span class="st">&quot;WITHDRAW AMOUNT&quot;</span> <span class="op">...</span> <span class="op">/&gt;</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">&lt;</span>StatCard title<span class="op">=</span><span class="st">&quot;GROSS GAMING REVENUE&quot;</span> <span class="op">...</span> <span class="op">/&gt;</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="op">&lt;</span>StatCard title<span class="op">=</span><span class="st">&quot;ACTIVE MEMBER&quot;</span> <span class="op">...</span> <span class="op">/&gt;</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="op">&lt;</span>StatCard title<span class="op">=</span><span class="st">&quot;PURCHASE FREQUENCY&quot;</span> <span class="op">...</span> <span class="op">/&gt;</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="op">&lt;</span>StatCard title<span class="op">=</span><span class="st">&quot;CUSTOMER MATURITY INDEX&quot;</span> <span class="op">...</span> <span class="op">/&gt;</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;/</span>div<span class="op">&gt;</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>style jsx<span class="op">&gt;</span>{<span class="vs">`</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="vs">  .kpi-row {</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="vs">    display: grid;</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="vs">    grid-template-columns: repeat(6, 1fr);</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="vs">    gap: 20px;</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="vs">    margin-bottom: 20px;</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="vs">  }</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span>}<span class="op">&lt;/</span>style<span class="op">&gt;</span></span></code></pre></div>
<p><strong>âœ… KEY POINTS</strong>: - âœ… 6 cards dalam 1 row (grid 6
kolom) - âœ… Setiap card punya icon, value, daily average, dan MoM - âœ…
Icon dari CentralIcon system (50+ icons) - âœ… Gap 18px antar cards
(CENTRALIZED) - âœ… Fixed height: 120px - âœ… Hover effect:
translateY(-2px) - âœ… Clickable untuk drill-down (optional)</p>
<p><strong>Dimensions</strong>: - Height: 120px (fixed) - Padding: 16px
- Gap: 18px between cards - Transition: 200ms ease</p>
<hr />
<h2 data-number="1.13" id="linechart-standard"><span
class="header-section-number">1.13</span> 11. LINECHART STANDARD</h2>
<h3 data-number="1.13.1" id="overview-4"><span
class="header-section-number">1.13.1</span> 11.1 Overview</h3>
<p>Line Chart dengan support 1-2 series data untuk trend
visualization.</p>
<p><strong>Component</strong>: <code>components/LineChart.tsx</code>
(957 lines)</p>
<p><strong>Used in</strong>: Overview, Business Performance, Member
Analytic, Brand Performance (ALL markets)</p>
<h3 data-number="1.13.2" id="single-line-usage"><span
class="header-section-number">1.13.2</span> 11.2 Single Line Usage</h3>
<div class="sourceCode" id="cb20"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>LineChart</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  series<span class="op">=</span>{[{ </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    name<span class="op">:</span> <span class="st">&#39;Deposit Amount&#39;</span><span class="op">,</span> </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    data<span class="op">:</span> sortedMonths<span class="op">.</span><span class="fu">map</span>(month <span class="kw">=&gt;</span> monthlyData[month]<span class="op">.</span><span class="at">deposit_amount</span>) </span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  }]}</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  categories<span class="op">=</span>{sortedMonths<span class="op">.</span><span class="fu">map</span>(month <span class="kw">=&gt;</span> month<span class="op">.</span><span class="fu">substring</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">3</span>))}</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  title<span class="op">=</span><span class="st">&quot;DEPOSIT AMOUNT TREND&quot;</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  currency<span class="op">=</span>{selectedCurrency}</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  hideLegend<span class="op">=</span>{<span class="kw">true</span>}</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  chartIcon<span class="op">=</span>{<span class="fu">getChartIcon</span>(<span class="st">&#39;Deposit Amount&#39;</span>)}</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="op">/&gt;</span></span></code></pre></div>
<h3 data-number="1.13.3" id="chart-configuration-single-line"><span
class="header-section-number">1.13.3</span> 11.3 Chart Configuration
(Single Line)</h3>
<div class="sourceCode" id="cb21"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Standard colors</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> lineColor <span class="op">=</span> <span class="st">&#39;#3B82F6&#39;</span> <span class="co">// Blue for single line</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> bgColor <span class="op">=</span> <span class="st">&#39;rgba(59, 130, 246, 0.15)&#39;</span> <span class="co">// Semi-transparent blue</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Chart options</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  responsive<span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  maintainAspectRatio<span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  plugins<span class="op">:</span> {</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    legend<span class="op">:</span> { display<span class="op">:</span> <span class="kw">false</span> }<span class="op">,</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    tooltip<span class="op">:</span> {</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>      mode<span class="op">:</span> <span class="st">&#39;index&#39;</span><span class="op">,</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>      intersect<span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>      backgroundColor<span class="op">:</span> <span class="st">&#39;rgba(0, 0, 0, 0.9)&#39;</span><span class="op">,</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>      callbacks<span class="op">:</span> {</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>        label<span class="op">:</span> <span class="kw">function</span>(context) {</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>          <span class="kw">const</span> value <span class="op">=</span> context<span class="op">.</span><span class="at">parsed</span><span class="op">.</span><span class="at">y</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>          <span class="cf">return</span> <span class="vs">`</span><span class="sc">${</span>context<span class="op">.</span><span class="at">dataset</span><span class="op">.</span><span class="at">label</span><span class="sc">}</span><span class="vs">: </span><span class="sc">${</span><span class="fu">formatFullValue</span>(value)<span class="sc">}</span><span class="vs">`</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>  scales<span class="op">:</span> {</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>    y<span class="op">:</span> {</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>      beginAtZero<span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>      suggestedMax<span class="op">:</span> maxValue <span class="op">*</span> <span class="fl">1.2</span><span class="op">,</span> <span class="co">// 20% padding</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>      grid<span class="op">:</span> {</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>        color<span class="op">:</span> <span class="st">&#39;rgba(229, 231, 235, 0.3)&#39;</span></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>âœ… KEY POINTS</strong>: - âœ… Single Y-axis - âœ… Blue color
(#3B82F6) - âœ… Semi-transparent background (20% opacity) - âœ… Icon +
title di header - âœ… White card background dengan hover effect
(translateY -3px) - âœ… Min height: 350px - âœ… Border radius: 8px - âœ…
Line width: 3px - âœ… Smooth curves (tension: 0.4) - âœ… Legend hidden
for single series</p>
<hr />
<h2 data-number="1.14" id="dual-line-chart"><span
class="header-section-number">1.14</span> 11.4 DUAL LINE CHART</h2>
<h3 data-number="1.14.1" id="dual-line-overview"><span
class="header-section-number">1.14.1</span> Dual Line Overview</h3>
<p>Line Chart dengan 2 series data dan <strong>DUAL Y-AXES</strong>
(independent scaling).</p>
<p><strong>Component</strong>: Same
<code>components/LineChart.tsx</code></p>
<p><strong>Auto-detection</strong>: Bila series.length &gt; 1 AND
forceSingleYAxis !== true â†’ Dual Y-axes</p>
<h3 data-number="1.14.2" id="dual-line-usage"><span
class="header-section-number">1.14.2</span> Dual Line Usage</h3>
<div class="sourceCode" id="cb22"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>LineChart</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  series<span class="op">=</span>{[</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    { </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>      name<span class="op">:</span> <span class="st">&#39;Active Member&#39;</span><span class="op">,</span> </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>      data<span class="op">:</span> sortedMonths<span class="op">.</span><span class="fu">map</span>(month <span class="kw">=&gt;</span> monthlyData[month]<span class="op">.</span><span class="at">active_member</span>) </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    { </span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>      name<span class="op">:</span> <span class="st">&#39;Purchase Frequency&#39;</span><span class="op">,</span> </span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>      data<span class="op">:</span> sortedMonths<span class="op">.</span><span class="fu">map</span>(month <span class="kw">=&gt;</span> monthlyData[month]<span class="op">.</span><span class="at">purchase_frequency</span>) </span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  ]}</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  categories<span class="op">=</span>{sortedMonths<span class="op">.</span><span class="fu">map</span>(month <span class="kw">=&gt;</span> month<span class="op">.</span><span class="fu">substring</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">3</span>))}</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  title<span class="op">=</span><span class="st">&quot;ACTIVE MEMBER &amp; PURCHASE FREQUENCY TREND&quot;</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>  currency<span class="op">=</span>{selectedCurrency}</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>  chartIcon<span class="op">=</span>{<span class="fu">getChartIcon</span>(<span class="st">&#39;Active Member&#39;</span>)}</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="op">/&gt;</span></span></code></pre></div>
<h3 data-number="1.14.3" id="dual-y-axis-configuration"><span
class="header-section-number">1.14.3</span> Dual Y-Axis
Configuration</h3>
<div class="sourceCode" id="cb23"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Colors for 2 lines</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> colors <span class="op">=</span> [</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;#3B82F6&#39;</span><span class="op">,</span> <span class="co">// Blue for first series</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;#F97316&#39;</span>  <span class="co">// Orange for second series</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Dual Y-axis setup</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>scales<span class="op">:</span> {</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  y<span class="op">:</span> {</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    type<span class="op">:</span> <span class="st">&#39;linear&#39;</span><span class="op">,</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    position<span class="op">:</span> <span class="st">&#39;left&#39;</span><span class="op">,</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// First series (Blue)</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>  y1<span class="op">:</span> {</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    type<span class="op">:</span> <span class="st">&#39;linear&#39;</span><span class="op">,</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>    position<span class="op">:</span> <span class="st">&#39;right&#39;</span><span class="op">,</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>    grid<span class="op">:</span> {</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>      drawOnChartArea<span class="op">:</span> <span class="kw">false</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Second series (Orange)</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a><span class="co">// Legend in header</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>div style<span class="op">=</span>{{ display<span class="op">:</span> <span class="st">&#39;flex&#39;</span><span class="op">,</span> gap<span class="op">:</span> <span class="st">&#39;12px&#39;</span> }}<span class="op">&gt;</span></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>  {series<span class="op">.</span><span class="fu">map</span>((item<span class="op">,</span> index) <span class="kw">=&gt;</span> (</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span>div key<span class="op">=</span>{index} style<span class="op">=</span>{{ display<span class="op">:</span> <span class="st">&#39;flex&#39;</span><span class="op">,</span> alignItems<span class="op">:</span> <span class="st">&#39;center&#39;</span><span class="op">,</span> gap<span class="op">:</span> <span class="st">&#39;6px&#39;</span> }}<span class="op">&gt;</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>      <span class="op">&lt;</span>div style<span class="op">=</span>{{</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>        width<span class="op">:</span> <span class="st">&#39;12px&#39;</span><span class="op">,</span></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>        height<span class="op">:</span> <span class="st">&#39;3px&#39;</span><span class="op">,</span></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>        backgroundColor<span class="op">:</span> colors[index]<span class="op">,</span></span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>        borderRadius<span class="op">:</span> <span class="st">&#39;2px&#39;</span></span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>      }} <span class="op">/&gt;</span></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>      <span class="op">&lt;</span>span style<span class="op">=</span>{{ fontSize<span class="op">:</span> <span class="st">&#39;11px&#39;</span><span class="op">,</span> fontWeight<span class="op">:</span> <span class="dv">600</span> }}<span class="op">&gt;</span></span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>        {item<span class="op">.</span><span class="at">name</span>}</span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>      <span class="op">&lt;/</span>span<span class="op">&gt;</span></span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;/</span>div<span class="op">&gt;</span></span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>  ))}</span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;/</span>div<span class="op">&gt;</span></span></code></pre></div>
<p><strong>âœ… KEY POINTS</strong>: - âœ… Dual Y-axes (left + right) -
âœ… Blue (#3B82F6) + Orange (#F97316) - âœ… Legend di header (bukan di
chart area) - âœ… Independent scaling untuk setiap series - âœ… Grid
lines only from left axis (right axis: drawOnChartArea: false) - âœ…
Same hover effect as single line - âœ… Auto-shown legend untuk
multi-series</p>
<hr />
<h2 data-number="1.15" id="barchart-standard"><span
class="header-section-number">1.15</span> 12. BARCHART STANDARD</h2>
<h3 data-number="1.15.1" id="overview-5"><span
class="header-section-number">1.15.1</span> 12.1 Overview</h3>
<p>Bar Chart dengan support 1-2 series data untuk comparison.</p>
<p><strong>Component</strong>: <code>components/BarChart.tsx</code> (699
lines)</p>
<p><strong>Used in</strong>: Overview, Business Performance,
Auto-Approval (ALL markets)</p>
<h3 data-number="1.15.2" id="single-bar-usage"><span
class="header-section-number">1.15.2</span> 12.2 Single Bar Usage</h3>
<div class="sourceCode" id="cb24"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>BarChart</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  series<span class="op">=</span>{[{ </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    name<span class="op">:</span> <span class="st">&#39;Deposit Cases&#39;</span><span class="op">,</span> </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    data<span class="op">:</span> sortedMonths<span class="op">.</span><span class="fu">map</span>(month <span class="kw">=&gt;</span> monthlyData[month]<span class="op">.</span><span class="at">deposit_cases</span>) </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  }]}</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  categories<span class="op">=</span>{sortedMonths<span class="op">.</span><span class="fu">map</span>(month <span class="kw">=&gt;</span> month<span class="op">.</span><span class="fu">substring</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">3</span>))}</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  title<span class="op">=</span><span class="st">&quot;DEPOSIT CASES TREND&quot;</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  currency<span class="op">=</span><span class="st">&quot;CASES&quot;</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  chartIcon<span class="op">=</span>{<span class="fu">getChartIcon</span>(<span class="st">&#39;deposits&#39;</span>)}</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="op">/&gt;</span></span></code></pre></div>
<h3 data-number="1.15.3" id="chart-configuration-single-bar"><span
class="header-section-number">1.15.3</span> 12.3 Chart Configuration
(Single Bar)</h3>
<div class="sourceCode" id="cb25"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Standard bar color</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> barColor <span class="op">=</span> <span class="st">&#39;#3B82F6&#39;</span> <span class="co">// Blue</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Chart options</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  responsive<span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  maintainAspectRatio<span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  plugins<span class="op">:</span> {</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    legend<span class="op">:</span> { display<span class="op">:</span> <span class="kw">false</span> }<span class="op">,</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    datalabels<span class="op">:</span> {</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>      display<span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>      anchor<span class="op">:</span> <span class="st">&#39;end&#39;</span><span class="op">,</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>      align<span class="op">:</span> <span class="st">&#39;top&#39;</span><span class="op">,</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>      offset<span class="op">:</span> <span class="op">-</span><span class="dv">2</span><span class="op">,</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>      formatter<span class="op">:</span> (value) <span class="kw">=&gt;</span> <span class="fu">formatIntegerKPI</span>(value) <span class="op">+</span> <span class="st">&#39;c&#39;</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>  scales<span class="op">:</span> {</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>    y<span class="op">:</span> {</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>      beginAtZero<span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>      max<span class="op">:</span> maxValue <span class="op">*</span> <span class="fl">1.08</span><span class="op">,</span> <span class="co">// 8% padding</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>      ticks<span class="op">:</span> {</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>        stepSize<span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">ceil</span>(maxValue <span class="op">/</span> <span class="dv">5</span>)</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>âœ… KEY POINTS</strong>: - âœ… Data labels ALWAYS on top
(showDataLabels default TRUE) - âœ… Blue bars (#3B82F6) - âœ… Consistent
Y-axis scaling (max * 1.08 + smart rounding) - âœ… Label position:
anchor ‘end’, align ‘top’, offset -2 - âœ… Bar radius: 4px - âœ… Min
height: 350px - âœ… Hover effect: translateY(-3px)</p>
<hr />
<h2 data-number="1.16" id="dual-bar-chart"><span
class="header-section-number">1.16</span> 12.4 DUAL BAR CHART</h2>
<h3 data-number="1.16.1" id="dual-bar-overview"><span
class="header-section-number">1.16.1</span> Dual Bar Overview</h3>
<p>Bar Chart dengan 2 series data (side-by-side bars).</p>
<p><strong>Component</strong>: Same
<code>components/BarChart.tsx</code></p>
<h3 data-number="1.16.2" id="dual-bar-usage"><span
class="header-section-number">1.16.2</span> Dual Bar Usage</h3>
<div class="sourceCode" id="cb26"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>BarChart</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  series<span class="op">=</span>{[</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    { </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>      name<span class="op">:</span> <span class="st">&#39;Deposit Cases&#39;</span><span class="op">,</span> </span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>      data<span class="op">:</span> sortedMonths<span class="op">.</span><span class="fu">map</span>(month <span class="kw">=&gt;</span> monthlyData[month]<span class="op">.</span><span class="at">deposit_cases</span>)<span class="op">,</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>      color<span class="op">:</span> <span class="st">&#39;#3B82F6&#39;</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    { </span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>      name<span class="op">:</span> <span class="st">&#39;Withdraw Cases&#39;</span><span class="op">,</span> </span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>      data<span class="op">:</span> sortedMonths<span class="op">.</span><span class="fu">map</span>(month <span class="kw">=&gt;</span> monthlyData[month]<span class="op">.</span><span class="at">withdraw_cases</span>)<span class="op">,</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>      color<span class="op">:</span> <span class="st">&#39;#F97316&#39;</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>  ]}</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>  categories<span class="op">=</span>{sortedMonths<span class="op">.</span><span class="fu">map</span>(month <span class="kw">=&gt;</span> month<span class="op">.</span><span class="fu">substring</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">3</span>))}</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>  title<span class="op">=</span><span class="st">&quot;DEPOSIT &amp; WITHDRAW CASES COMPARISON&quot;</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>  currency<span class="op">=</span><span class="st">&quot;CASES&quot;</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>  customLegend<span class="op">=</span>{[</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>    { label<span class="op">:</span> <span class="st">&#39;Deposit Cases&#39;</span><span class="op">,</span> color<span class="op">:</span> <span class="st">&#39;#3B82F6&#39;</span> }<span class="op">,</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>    { label<span class="op">:</span> <span class="st">&#39;Withdraw Cases&#39;</span><span class="op">,</span> color<span class="op">:</span> <span class="st">&#39;#F97316&#39;</span> }</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>  ]}</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a><span class="op">/&gt;</span></span></code></pre></div>
<h3 data-number="1.16.3" id="dual-bar-configuration"><span
class="header-section-number">1.16.3</span> Dual Bar Configuration</h3>
<div class="sourceCode" id="cb27"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Colors</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> colors <span class="op">=</span> [<span class="st">&#39;#3B82F6&#39;</span><span class="op">,</span> <span class="st">&#39;#F97316&#39;</span>] <span class="co">// Blue + Orange</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Bar datasets</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>datasets<span class="op">:</span> series<span class="op">.</span><span class="fu">map</span>((dataset<span class="op">,</span> index) <span class="kw">=&gt;</span> ({</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  label<span class="op">:</span> dataset<span class="op">.</span><span class="at">name</span><span class="op">,</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  data<span class="op">:</span> dataset<span class="op">.</span><span class="at">data</span><span class="op">,</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  backgroundColor<span class="op">:</span> dataset<span class="op">.</span><span class="at">color</span> <span class="op">||</span> colors[index]<span class="op">,</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  borderRadius<span class="op">:</span> <span class="dv">4</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>}))</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="co">// Legend in header</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>{customLegend <span class="op">&amp;&amp;</span> (</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>  <span class="op">&lt;</span>div style<span class="op">=</span>{{ display<span class="op">:</span> <span class="st">&#39;flex&#39;</span><span class="op">,</span> gap<span class="op">:</span> <span class="st">&#39;16px&#39;</span> }}<span class="op">&gt;</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>    {customLegend<span class="op">.</span><span class="fu">map</span>((item<span class="op">,</span> idx) <span class="kw">=&gt;</span> (</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>      <span class="op">&lt;</span>div key<span class="op">=</span>{idx}<span class="op">&gt;</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">&lt;</span>span style<span class="op">=</span>{{</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>          width<span class="op">:</span> <span class="st">&#39;14px&#39;</span><span class="op">,</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>          height<span class="op">:</span> <span class="st">&#39;4px&#39;</span><span class="op">,</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>          backgroundColor<span class="op">:</span> item<span class="op">.</span><span class="at">color</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>        }} <span class="op">/&gt;</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>        <span class="op">&lt;</span>span<span class="op">&gt;</span>{item<span class="op">.</span><span class="at">label</span>}<span class="op">&lt;/</span>span<span class="op">&gt;</span></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>      <span class="op">&lt;/</span>div<span class="op">&gt;</span></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>    ))}</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>  <span class="op">&lt;/</span>div<span class="op">&gt;</span></span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>)}</span></code></pre></div>
<p><strong>âœ… KEY POINTS</strong>: - âœ… Side-by-side bars (grouped) -
âœ… Custom colors per series (Blue + Orange) - âœ… Legend di header -
âœ… Consistent scaling untuk fair comparison - âœ… Data labels for both
series - âœ… Same Y-axis for both (not independent like Line Chart)</p>
<hr />
<h2 data-number="1.17" id="layout-frame-standard"><span
class="header-section-number">1.17</span> 13. LAYOUT &amp; FRAME
STANDARD</h2>
<h3 data-number="1.17.1" id="layout-component"><span
class="header-section-number">1.17.1</span> 13.1 Layout Component</h3>
<p><strong>File</strong>: <code>components/Layout.tsx</code> (84
lines)</p>
<p><strong>Usage</strong>: ALL 42 pages</p>
<pre class="tsx"><code>&lt;Layout customSubHeader={customSubHeader}&gt;
  &lt;Frame variant=&quot;standard&quot;&gt;
    {/* Page content */}
  &lt;/Frame&gt;
&lt;/Layout&gt;</code></pre>
<p><strong>Structure</strong>: - Sidebar (280px expanded, 100px
collapsed) - Header (70px fixed) - SubHeader (60px fixed, optional) -
Main Content (auto-adjust dengan margin-left) - FeedbackWidget
(floating)</p>
<h3 data-number="1.17.2" id="frame-component"><span
class="header-section-number">1.17.2</span> 13.2 Frame Component</h3>
<p><strong>File</strong>: <code>components/Frame.tsx</code> (32
lines)</p>
<p><strong>Variants</strong>:</p>
<pre class="tsx"><code>&lt;Frame variant=&quot;standard&quot;&gt;  {/* Default: padding 20px, gap 18px */}
&lt;Frame variant=&quot;compact&quot;&gt;   {/* Tighter spacing */}
&lt;Frame variant=&quot;full&quot;&gt;      {/* Full width, no margin */}</code></pre>
<p><strong>Dimensions</strong>: - Standard: padding 20px, gap 18px,
height calc(100vh - 130px) - Compact: Same gap, adjusted height - Full:
padding 32px, height 100vh</p>
<hr />
<h2 data-number="1.18" id="slicer-components"><span
class="header-section-number">1.18</span> 14. SLICER COMPONENTS</h2>
<h3 data-number="1.18.1" id="available-slicers-7-components"><span
class="header-section-number">1.18.1</span> 14.1 Available Slicers (7
components)</h3>
<p><strong>File</strong>: <code>components/slicers/</code></p>
<table>
<colgroup>
<col style="width: 40%" />
<col style="width: 33%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr>
<th>Component</th>
<th>Purpose</th>
<th>Props</th>
</tr>
</thead>
<tbody>
<tr>
<td>YearSlicer</td>
<td>Year selection</td>
<td>years, selectedYear, onYearChange</td>
</tr>
<tr>
<td>MonthSlicer</td>
<td>Month selection</td>
<td>months, selectedMonth, onMonthChange</td>
</tr>
<tr>
<td>QuarterSlicer</td>
<td>Quarter selection</td>
<td>quarters, selectedQuarter, onQuarterChange</td>
</tr>
<tr>
<td>LineSlicer</td>
<td>Brand selection</td>
<td>lines, selectedLine, onLineChange</td>
</tr>
<tr>
<td>CurrencySlicer</td>
<td>Currency selection</td>
<td>currencies, selectedCurrency, onCurrencyChange</td>
</tr>
<tr>
<td>DateRangeSlicer</td>
<td>Date range picker</td>
<td>startDate, endDate, min, max, onChange</td>
</tr>
<tr>
<td>QuickDateFilter</td>
<td>Quick date shortcuts</td>
<td>onDateRangeChange, availableRange</td>
</tr>
</tbody>
</table>
<h3 data-number="1.18.2" id="standard-slicer-pattern"><span
class="header-section-number">1.18.2</span> 14.2 Standard Slicer
Pattern</h3>
<pre class="tsx"><code>import { YearSlicer, MonthSlicer, LineSlicer } from &#39;@/components/slicers&#39;

&lt;div className=&quot;slicer-group&quot;&gt;
  &lt;label className=&quot;slicer-label&quot;&gt;YEAR:&lt;/label&gt;
  &lt;YearSlicer
    years={slicerOptions?.years || []}
    selectedYear={selectedYear}
    onYearChange={setSelectedYear}
  /&gt;
&lt;/div&gt;</code></pre>
<hr />
<h2 data-number="1.19" id="modal-components"><span
class="header-section-number">1.19</span> 15. MODAL COMPONENTS</h2>
<h3 data-number="1.19.1" id="activememberdetailsmodal"><span
class="header-section-number">1.19.1</span> 15.1
ActiveMemberDetailsModal</h3>
<p><strong>File</strong>:
<code>components/ActiveMemberDetailsModal.tsx</code></p>
<p><strong>Features</strong>: - âœ… Pagination (20/50/100/500/1000 rows)
- âœ… Status filter (Retention/Reactivation/New Depositor) - âœ… Brand
filter - âœ… Export CSV (ALL data) - âœ… Mini KPI cards (4 KPIs) - âœ…
17 columns table - âœ… Sticky header - âœ… Net profit color coding</p>
<p><strong>Usage</strong>:</p>
<pre class="tsx"><code>&lt;ActiveMemberDetailsModal
  isOpen={showModal}
  onClose={() =&gt; setShowModal(false)}
  totalCount={kpiData?.activeMember || 0}
  currency={selectedCurrency}
  year={selectedYear}
  quarter={selectedQuarter}
/&gt;</code></pre>
<h3 data-number="1.19.2" id="targeteditmodal"><span
class="header-section-number">1.19.2</span> 15.2 TargetEditModal</h3>
<p><strong>Features</strong>: - âœ… Two-step input (Total â†’ Brand
breakdown) - âœ… Auto-calculate dari percentage - âœ… Target list table
(editable) - âœ… Role-based access - âœ… Percentage validation - âœ…
Audit trail automatic</p>
<h3 data-number="1.19.3" id="other-modals"><span
class="header-section-number">1.19.3</span> 15.3 Other Modals</h3>
<ul>
<li><strong>TargetAchieveModal</strong>: Target achievement
breakdown</li>
<li><strong>CustomerDetailModal</strong>: Customer detail
drill-down</li>
<li><strong>ChartZoomModal</strong>: Full-screen chart view</li>
<li><strong>OverdueDetailsModal</strong>: Overdue transactions</li>
</ul>
<hr />
<h2 data-number="1.20" id="overview-page-pattern"><span
class="header-section-number">1.20</span> 16. OVERVIEW PAGE PATTERN</h2>
<h3 data-number="1.20.1" id="structure-all-markets-myr-sgd-usc"><span
class="header-section-number">1.20.1</span> 16.1 Structure (ALL Markets:
MYR, SGD, USC)</h3>
<p><strong>Pages</strong>: - <code>/myr/overview/page.tsx</code> -
<code>/sgd/overview/page.tsx</code> -
<code>/usc/overview/page.tsx</code></p>
<p><strong>Layout</strong>:</p>
<pre><code>Row 1: 6 KPI Cards (grid-cols-6, gap 18px)
Row 2: 3 Charts (grid-cols-3, gap 18px)
Row 3: 3 Charts (grid-cols-3, gap 18px)</code></pre>
<p><strong>Slicers</strong>: Year, Month, Line</p>
<p><strong>KPIs Displayed</strong> (6 cards): 1. Deposit Amount
(Currency + Daily Avg + MoM) 2. Withdraw Amount (Currency + Daily Avg +
MoM) 3. Gross Gaming Revenue (Currency + Daily Avg + MoM) 4. Active
Member (Integer + Daily Avg + MoM) 5. Purchase Frequency (Numeric +
Daily Avg + MoM) 6. Customer Maturity Index (Percentage + Daily Avg +
MoM)</p>
<p><strong>Charts</strong> (6 charts): 1. Deposit Amount Trend (Line,
single) 2. Active Member &amp; PF Trend (Line, dual Y-axes) 3. Deposit
&amp; Withdraw Comparison (Line, dual Y-axes) 4. Deposit Cases Trend
(Bar, single) 5. Deposit &amp; Withdraw Cases (Bar, dual) 6. Net Profit
Trend (Line, single)</p>
<hr />
<h2 data-number="1.21" id="business-performance-pattern"><span
class="header-section-number">1.21</span> 17. BUSINESS PERFORMANCE
PATTERN</h2>
<h3 data-number="1.21.1" id="structure-myr-sgd-usc"><span
class="header-section-number">1.21.1</span> 17.1 Structure (MYR, SGD,
USC)</h3>
<p><strong>Pages</strong>: -
<code>/myr/business-performance/page.tsx</code> -
<code>/sgd/business-performance/page.tsx</code> -
<code>/usc/business-performance/page.tsx</code></p>
<p><strong>Unique Features</strong>: - âœ… Mode toggle: Daily/Quarter -
âœ… Target comparison (vs bp_target table) - âœ… Active Member
drill-down modal - âœ… Target achieve modal - âœ… Achievement %
indicators</p>
<p><strong>Slicers</strong>: Quarter (or Date Range for Daily), Line</p>
<p><strong>KPIs</strong> (6 cards): 1. GGR (with target comparison) 2.
Deposit Amount (with target) 3. Deposit Cases (with target) 4. Active
Member (clickable â†’ drill-down) 5. Pure User 6. Net Profit</p>
<p><strong>Charts</strong> (3 charts): 1. Transaction Metrics (Bar,
dual: Deposit + Withdraw Cases) 2. User Value Metrics (Line, dual:
Active Member + GGR Pure User) 3. Retention &amp; Churn (Line, dual
Y-axes: Retention Rate + Churn Member)</p>
<hr />
<h2 data-number="1.22" id="member-report-pattern"><span
class="header-section-number">1.22</span> 18. MEMBER REPORT PATTERN</h2>
<h3 data-number="1.22.1" id="structure-all-markets"><span
class="header-section-number">1.22.1</span> 18.1 Structure (ALL
Markets)</h3>
<p><strong>Pages</strong>: - <code>/myr/member-report/page.tsx</code> -
<code>/sgd/member-report/page.tsx</code> -
<code>/usc/member-report/page.tsx</code></p>
<p><strong>Features</strong>: - âœ… 3-4 KPI cards (summary) - âœ… Large
table (1000 rows per page) - âœ… Pagination (server-side) - âœ… Export
CSV (ALL data) - âœ… Sorting capabilities - âœ… Color coding (Net
Profit: red/green)</p>
<p><strong>Table Columns</strong> (~15 columns): - Line, User Name,
Unique Code - First Deposit Date, Last Deposit Date - Deposit Cases,
Deposit Amount - Withdraw Cases, Withdraw Amount - GGR, Net Profit -
Winrate, etc.</p>
<hr />
<h2 data-number="1.23" id="customer-retention-pattern"><span
class="header-section-number">1.23</span> 19. CUSTOMER RETENTION
PATTERN</h2>
<h3 data-number="1.23.1" id="structure-all-markets-1"><span
class="header-section-number">1.23.1</span> 19.1 Structure (ALL
Markets)</h3>
<p><strong>Pages</strong>: -
<code>/myr/customer-retention/page.tsx</code> -
<code>/sgd/customer-retention/page.tsx</code> -
<code>/usc/customer-retention/page.tsx</code></p>
<p><strong>Unique Features</strong>: - âœ… NO KPI cards (table-focused)
- âœ… Status filter (NEW DEPOSITOR, RETENTION, REACTIVATION) - âœ… Date
Range toggle (within selected month) - âœ… Active Days clickable â†’
Transaction history modal - âœ… Server-side status filtering (Nov 2025)
- âœ… Export CSV with filter</p>
<p><strong>Table Columns</strong> (17 columns): - Brand, User Name,
Unique Code - FDD, LDD, Active Days (clickable) - ATV, PF - DC, DA, WC,
WA - Bonus, Net Profit - Winrate, WD Rate - Status (colored label)</p>
<p><strong>Status Classification</strong>: - <strong>NEW
DEPOSITOR</strong>: first_deposit_date dalam bulan dipilih -
<strong>RETENTION</strong>: Main bulan lalu DAN bulan ini -
<strong>REACTIVATION</strong>: Tidak main bulan lalu TAPI main bulan
ini</p>
<hr />
<h2 data-number="1.24" id="server-side-filtering"><span
class="header-section-number">1.24</span> 20. SERVER-SIDE FILTERING</h2>
<h3 data-number="1.24.1" id="overview-new---nov-2025"><span
class="header-section-number">1.24.1</span> 20.1 Overview (NEW - Nov
2025)</h3>
<p>Filter di server untuk better performance dan accurate pagination
info.</p>
<p><strong>Implementation</strong>: Customer Retention pages (ALL
markets)</p>
<h3 data-number="1.24.2" id="pattern"><span
class="header-section-number">1.24.2</span> 20.2 Pattern</h3>
<p><strong>See Section 11 above</strong> untuk complete implementation
pattern.</p>
<p><strong>Key Benefits</strong>: - âš¡ Faster (filter before
pagination) - ðŸ“Š Accurate totals (reflects filtered count) - ðŸ”’
Secure (logic on server) - âœ… Consistent (display + export use same
logic)</p>
<hr />
<h2 data-number="1.25" id="brand-access-control"><span
class="header-section-number">1.25</span> 21. BRAND ACCESS CONTROL</h2>
<h3 data-number="1.25.1" id="overview-new---nov-2025-1"><span
class="header-section-number">1.25.1</span> 21.1 Overview (NEW - Nov
2025)</h3>
<p>Role-based brand filtering untuk Squad Lead vs Admin/Manager.</p>
<p><strong>See Section 12 above</strong> untuk complete implementation
pattern.</p>
<p><strong>Key Points</strong>: - Squad Lead: Filtered brands only, NO
‘ALL’ option - Admin/Manager: ALL brands + ‘ALL’ option - Permission
check di SEMUA API routes - Unauthorized response (403) bila access
denied</p>
<hr />
<h2 data-number="1.26" id="transaction-history-drill-down"><span
class="header-section-number">1.26</span> 22. TRANSACTION HISTORY
DRILL-DOWN</h2>
<h3 data-number="1.26.1" id="overview-new---nov-2025-2"><span
class="header-section-number">1.26.1</span> 22.1 Overview (NEW - Nov
2025)</h3>
<p>Click pada Active Days â†’ Modal dengan daily transaction
history.</p>
<p><strong>See Section 13 above</strong> untuk complete implementation
pattern.</p>
<p><strong>Features</strong>: - Daily transaction breakdown per user -
Pagination dalam modal (100 rows/page) - Export CSV dari modal - Sticky
header dengan max height</p>
<hr />
<h2 data-number="1.27" id="format-helpers-reference"><span
class="header-section-number">1.27</span> 23. FORMAT HELPERS
REFERENCE</h2>
<h3 data-number="1.27.1" id="overview-6"><span
class="header-section-number">1.27.1</span> 23.1 Overview</h3>
<p>Standard formatting untuk SEMUA KPI values di ALL pages.</p>
<p><strong>Source</strong>: <code>lib/formatHelpers.ts</code> (123
lines)</p>
<h3 data-number="1.27.2" id="format-functions"><span
class="header-section-number">1.27.2</span> 23.2 Format Functions</h3>
<div class="sourceCode" id="cb33"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co"> * Format numeric with 2 decimal places</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="co"> * Used for: ATV, CLV, ACL, PF, etc.</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">const</span> formatNumericKPI <span class="op">=</span> (value<span class="op">:</span> <span class="dt">number</span>)<span class="op">:</span> <span class="dt">string</span> <span class="kw">=&gt;</span> {</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="kw">new</span> <span class="bu">Intl</span><span class="op">.</span><span class="fu">NumberFormat</span>(<span class="st">&#39;en-US&#39;</span><span class="op">,</span> {</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    minimumFractionDigits<span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    maximumFractionDigits<span class="op">:</span> <span class="dv">2</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  })<span class="op">.</span><span class="fu">format</span>(value)<span class="op">;</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="co"> * Format integer with no decimal</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="co"> * Used for: Active Member, Cases, Headcount, etc.</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">const</span> formatIntegerKPI <span class="op">=</span> (value<span class="op">:</span> <span class="dt">number</span>)<span class="op">:</span> <span class="dt">string</span> <span class="kw">=&gt;</span> {</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="kw">new</span> <span class="bu">Intl</span><span class="op">.</span><span class="fu">NumberFormat</span>(<span class="st">&#39;en-US&#39;</span><span class="op">,</span> {</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>    minimumFractionDigits<span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>    maximumFractionDigits<span class="op">:</span> <span class="dv">0</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>  })<span class="op">.</span><span class="fu">format</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(value))<span class="op">;</span></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a><span class="co"> * Format currency with symbol</span></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a><span class="co"> * Used for: Deposit, Withdraw, GGR, Net Profit, etc.</span></span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">const</span> formatCurrencyKPI <span class="op">=</span> (value<span class="op">:</span> <span class="dt">number</span><span class="op">,</span> currency<span class="op">:</span> <span class="dt">string</span>)<span class="op">:</span> <span class="dt">string</span> <span class="kw">=&gt;</span> {</span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> symbol <span class="op">=</span> currency <span class="op">===</span> <span class="st">&#39;MYR&#39;</span> <span class="op">?</span> <span class="st">&#39;RM&#39;</span> <span class="op">:</span> </span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>                 currency <span class="op">===</span> <span class="st">&#39;SGD&#39;</span> <span class="op">?</span> <span class="st">&#39;SGD&#39;</span> <span class="op">:</span> </span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>                 currency <span class="op">===</span> <span class="st">&#39;USC&#39;</span> <span class="op">?</span> <span class="st">&#39;USD&#39;</span> <span class="op">:</span> <span class="st">&#39;RM&#39;</span></span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> formatted <span class="op">=</span> <span class="kw">new</span> <span class="bu">Intl</span><span class="op">.</span><span class="fu">NumberFormat</span>(<span class="st">&#39;en-US&#39;</span><span class="op">,</span> {</span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>    minimumFractionDigits<span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>    maximumFractionDigits<span class="op">:</span> <span class="dv">2</span></span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>  })<span class="op">.</span><span class="fu">format</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(value))</span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> sign <span class="op">=</span> value <span class="op">&lt;</span> <span class="dv">0</span> <span class="op">?</span> <span class="st">&#39;-&#39;</span> <span class="op">:</span> <span class="st">&#39;&#39;</span></span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="vs">`</span><span class="sc">${</span>symbol<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>sign<span class="sc">}${</span>formatted<span class="sc">}</span><span class="vs">`</span></span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-41"><a href="#cb33-41" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb33-42"><a href="#cb33-42" aria-hidden="true" tabindex="-1"></a><span class="co"> * Format percentage</span></span>
<span id="cb33-43"><a href="#cb33-43" aria-hidden="true" tabindex="-1"></a><span class="co"> * Used for: Rates, CMI, etc.</span></span>
<span id="cb33-44"><a href="#cb33-44" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb33-45"><a href="#cb33-45" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">const</span> formatPercentageKPI <span class="op">=</span> (value<span class="op">:</span> <span class="dt">number</span>)<span class="op">:</span> <span class="dt">string</span> <span class="kw">=&gt;</span> {</span>
<span id="cb33-46"><a href="#cb33-46" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="vs">`</span><span class="sc">${</span><span class="kw">new</span> <span class="bu">Intl</span><span class="op">.</span><span class="fu">NumberFormat</span>(<span class="st">&#39;en-US&#39;</span><span class="op">,</span> {</span>
<span id="cb33-47"><a href="#cb33-47" aria-hidden="true" tabindex="-1"></a>    minimumFractionDigits<span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb33-48"><a href="#cb33-48" aria-hidden="true" tabindex="-1"></a>    maximumFractionDigits<span class="op">:</span> <span class="dv">2</span></span>
<span id="cb33-49"><a href="#cb33-49" aria-hidden="true" tabindex="-1"></a>  })<span class="op">.</span><span class="fu">format</span>(value)<span class="sc">}</span><span class="vs">%`</span></span>
<span id="cb33-50"><a href="#cb33-50" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-51"><a href="#cb33-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-52"><a href="#cb33-52" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb33-53"><a href="#cb33-53" aria-hidden="true" tabindex="-1"></a><span class="co"> * Format MoM change with sign</span></span>
<span id="cb33-54"><a href="#cb33-54" aria-hidden="true" tabindex="-1"></a><span class="co"> * Used for: MoM comparison</span></span>
<span id="cb33-55"><a href="#cb33-55" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb33-56"><a href="#cb33-56" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">const</span> formatMoMChange <span class="op">=</span> (value<span class="op">:</span> <span class="dt">number</span>)<span class="op">:</span> <span class="dt">string</span> <span class="kw">=&gt;</span> {</span>
<span id="cb33-57"><a href="#cb33-57" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> sign <span class="op">=</span> value <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> <span class="st">&#39;+&#39;</span> <span class="op">:</span> <span class="st">&#39;&#39;</span></span>
<span id="cb33-58"><a href="#cb33-58" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="vs">`</span><span class="sc">${</span>sign<span class="sc">}${</span><span class="kw">new</span> <span class="bu">Intl</span><span class="op">.</span><span class="fu">NumberFormat</span>(<span class="st">&#39;en-US&#39;</span><span class="op">,</span> {</span>
<span id="cb33-59"><a href="#cb33-59" aria-hidden="true" tabindex="-1"></a>    minimumFractionDigits<span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb33-60"><a href="#cb33-60" aria-hidden="true" tabindex="-1"></a>    maximumFractionDigits<span class="op">:</span> <span class="dv">2</span></span>
<span id="cb33-61"><a href="#cb33-61" aria-hidden="true" tabindex="-1"></a>  })<span class="op">.</span><span class="fu">format</span>(value)<span class="sc">}</span><span class="vs">%`</span></span>
<span id="cb33-62"><a href="#cb33-62" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 data-number="1.27.3" id="format-standards-all-markets"><span
class="header-section-number">1.27.3</span> 23.3 Format Standards (ALL
Markets)</h3>
<table>
<colgroup>
<col style="width: 17%" />
<col style="width: 14%" />
<col style="width: 22%" />
<col style="width: 22%" />
<col style="width: 22%" />
</colgroup>
<thead>
<tr>
<th>KPI Type</th>
<th>Format</th>
<th>MYR Example</th>
<th>SGD Example</th>
<th>USC Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Currency</strong></td>
<td><code>{SYMBOL} 0,000.00</code></td>
<td>RM 1,234,567.89</td>
<td>SGD 1,234,567.89</td>
<td>USD 1,234,567.89</td>
</tr>
<tr>
<td><strong>Numeric</strong></td>
<td><code>0,000.00</code></td>
<td>1,234.56</td>
<td>1,234.56</td>
<td>1,234.56</td>
</tr>
<tr>
<td><strong>Integer</strong></td>
<td><code>0,000</code></td>
<td>12,345</td>
<td>12,345</td>
<td>12,345</td>
</tr>
<tr>
<td><strong>Percentage</strong></td>
<td><code>0.00%</code></td>
<td>12.34%</td>
<td>12.34%</td>
<td>12.34%</td>
</tr>
<tr>
<td><strong>MoM</strong></td>
<td><code>+0.00%</code> or <code>-0.00%</code></td>
<td>+5.67%</td>
<td>-3.21%</td>
<td>+2.45%</td>
</tr>
</tbody>
</table>
<p><strong>âœ… KEY POINTS</strong>: - âœ… ALWAYS use thousand separators
- âœ… Currency: 2 decimal places - âœ… Integer: NO decimal places - âœ…
MoM: include sign (+/-) - âœ… Consistent across ALL markets - âœ… Use
formatHelpers untuk semua displays</p>
<hr />
<h2 data-number="1.28" id="checklists"><span
class="header-section-number">1.28</span> 24. CHECKLISTS</h2>
<h3 data-number="1.28.1" id="new-page-development-checklist"><span
class="header-section-number">1.28.1</span> 24.1 New Page Development
Checklist</h3>
<p><strong>Before Starting</strong>: - [ ] Check existing similar pages
untuk reference - [ ] Read NEXMAX_STANDARDS_COMPLETE_REFERENCE.md (this
doc) - [ ] Read CRM_DASHBOARD_HANDBOOK.md - [ ] Understand data sources
(Master vs MV)</p>
<p><strong>API Development</strong>: - [ ] Create
<code>/api/{currency}-{feature}/slicer-options/route.ts</code> - [ ]
Create <code>/api/{currency}-{feature}/chart-data/route.ts</code> (if
needed) - [ ] Create
<code>/api/{currency}-{feature}/kpi-data/route.ts</code> (if needed) - [
] Create <code>/api/{currency}-{feature}/data/route.ts</code> (if table
needed) - [ ] Create
<code>/api/{currency}-{feature}/export/route.ts</code> (if export
needed) - [ ] Implement brand access control di ALL routes - [ ] Add
error handling di ALL routes - [ ] Test API responses</p>
<p><strong>Page Development</strong>: - [ ] Copy template dari existing
page - [ ] Update imports (currency-specific logic file) - [ ] Implement
hydration fix (isMounted) - [ ] Load slicer options dengan brand
filtering - [ ] Load KPI data dengan MoM + Daily Average - [ ] Load
chart data (if applicable) - [ ] Implement custom SubHeader dengan
slicers - [ ] Use StatCard dengan proper formatting - [ ] Use Charts
dengan proper configuration - [ ] Add loading states - [ ] Add error
states - [ ] Test responsive design - [ ] Check accessibility (ARIA
labels) - [ ] Verify brand filtering works</p>
<p><strong>Final Checks</strong>: - [ ] No linter errors - [ ] No
TypeScript errors - [ ] No dummy/fallback data - [ ] All data dari
Supabase - [ ] Format consistency (formatHelpers) - [ ] Icons dari
CentralIcon - [ ] Spacing: 18px gap everywhere - [ ] Colors: Blue/Orange
standard - [ ] Hover effects working - [ ] Export functionality (if
applicable) - [ ] Drill-down modals (if applicable) - [ ] Update sidebar
menu (if new page)</p>
<h3 data-number="1.28.2" id="api-development-checklist"><span
class="header-section-number">1.28.2</span> 24.2 API Development
Checklist</h3>
<p><strong>Slicer Options API</strong>: - [ ] Fetch DISTINCT lines from
correct table - [ ] Fetch years (sorted DESC) - [ ] Fetch months WITH
year mapping - [ ] Build month-year mapping object - [ ] Apply brand
filtering (Squad Lead) - [ ] Remove ‘ALL’ for Squad Lead - [ ] Calculate
defaults from latest record - [ ] Return structured response - [ ] Add
error handling</p>
<p><strong>Data API</strong>: - [ ] Get user allowed brands from header
- [ ] Build base query dengan currency lock - [ ] Apply brand filter
dengan permission check - [ ] Apply year/month/date filters - [ ] Fetch
from correct table (Master vs MV) - [ ] Process/aggregate data if needed
- [ ] Calculate derived KPIs - [ ] Apply pagination (if applicable) - [
] Return with pagination info - [ ] Add error handling</p>
<p><strong>Export API</strong>: - [ ] Accept filters dari request body -
[ ] Fetch data (SAME logic as display) - [ ] Apply filters (server-side)
- [ ] Convert to CSV format - [ ] Add BOM for Excel UTF-8 - [ ] Set
proper headers - [ ] Generate timestamp filename - [ ] Return CSV file -
[ ] Add error handling</p>
<h3 data-number="1.28.3" id="component-usage-checklist"><span
class="header-section-number">1.28.3</span> 24.3 Component Usage
Checklist</h3>
<p><strong>StatCard</strong>: - [ ] Use formatCurrencyKPI untuk currency
values - [ ] Use formatIntegerKPI untuk counts - [ ] Use
formatNumericKPI untuk decimals - [ ] Use formatPercentageKPI untuk
rates - [ ] Use formatMoMChange untuk MoM - [ ] Include icon from
CentralIcon - [ ] Add additionalKpi (Daily Average) - [ ] Add comparison
(MoM) - [ ] Handle onClick if clickable</p>
<p><strong>LineChart</strong>: - [ ] Use dynamic import (ssr: false) - [
] Provide series array dengan data - [ ] Provide categories (month
names) - [ ] Set title (UPPERCASE) - [ ] Set currency - [ ] Add
chartIcon from getChartIcon() - [ ] Set hideLegend untuk single series -
[ ] Let auto-show legend untuk dual series - [ ] Verify dual Y-axes
untuk 2 series</p>
<p><strong>BarChart</strong>: - [ ] Use dynamic import (ssr: false) - [
] Provide series array - [ ] Provide categories - [ ] Set title
(UPPERCASE) - [ ] Set currency - [ ] Add chartIcon - [ ] Keep
showDataLabels=true (default) - [ ] Add customLegend untuk dual bars</p>
<hr />
<h2 data-number="1.29" id="troubleshooting"><span
class="header-section-number">1.29</span> 25. TROUBLESHOOTING</h2>
<h3 data-number="1.29.1" id="common-issues-solutions"><span
class="header-section-number">1.29.1</span> 25.1 Common Issues &amp;
Solutions</h3>
<p><strong>Issue 1</strong>: Chart not rendering</p>
<pre><code>Symptoms: White box, no chart visible
Cause: Missing dynamic import
Fix: const LineChart = dynamic(() =&gt; import(&#39;@/components/LineChart&#39;), { ssr: false })</code></pre>
<p><strong>Issue 2</strong>: Hydration mismatch error</p>
<pre><code>Symptoms: Console error about server/client mismatch
Cause: Server-rendered different from client
Fix: Add isMounted check:
  const [isMounted, setIsMounted] = useState(false)
  useEffect(() =&gt; { setIsMounted(true) }, [])
  if (!isMounted) return null</code></pre>
<p><strong>Issue 3</strong>: Slicer options empty</p>
<pre><code>Symptoms: Empty dropdowns
Cause: Brand filtering issue atau cache
Fix: 
  1. Check &#39;x-user-allowed-brands&#39; header
  2. Add cache: &#39;no-store&#39; to fetch
  3. Verify table name (MV vs Master)</code></pre>
<p><strong>Issue 4</strong>: Wrong currency symbol</p>
<pre><code>Symptoms: &quot;RM&quot; shown on USC page
Cause: Currency parameter mismatch
Fix: Verify currency lock in API (.eq(&#39;currency&#39;, &#39;USC&#39;))</code></pre>
<p><strong>Issue 5</strong>: MoM calculation wrong for December</p>
<pre><code>Symptoms: MoM = 0 or wrong value for Dec/Jan boundary
Cause: Previous month not handling year boundary
Fix: Use getPreviousMonth() helper function</code></pre>
<p><strong>Issue 6</strong>: Data not loading</p>
<pre><code>Symptoms: Loading spinner forever
Cause: useEffect dependencies missing atau API error
Fix:
  1. Check useEffect dependencies array
  2. Check console for API errors
  3. Verify slicers are set before fetching</code></pre>
<p><strong>Issue 7</strong>: Permission denied (403)</p>
<pre><code>Symptoms: &quot;Unauthorized&quot; error
Cause: Squad Lead trying to access unassigned brand
Fix: Verify user&#39;s allowed_brands in localStorage</code></pre>
<p><strong>Issue 8</strong>: Pagination showing wrong total</p>
<pre><code>Symptoms: &quot;Showing 100 of 50,000&quot; but only 5,000 filtered
Cause: Client-side filtering after pagination
Fix: Implement server-side filtering (see Section 20)</code></pre>
<p><strong>Issue 9</strong>: Export downloads empty file</p>
<pre><code>Symptoms: CSV file empty or missing data
Cause: Export route not applying same filters
Fix: Ensure export uses SAME logic as display</code></pre>
<p><strong>Issue 10</strong>: Active Days not clickable</p>
<pre><code>Symptoms: Can&#39;t open transaction history modal
Cause: Missing click handler atau missing modal component
Fix: Implement handleActiveDaysClick + TransactionHistoryModal</code></pre>
<hr />
<h2 data-number="1.30" id="ðÿš-summary-checklist"><span
class="header-section-number">1.30</span> ðŸ“Š SUMMARY CHECKLIST</h2>
<div class="sourceCode" id="cb44"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;use client&#39;</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> React<span class="op">,</span> { useState<span class="op">,</span> useEffect } <span class="im">from</span> <span class="st">&#39;react&#39;</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> dynamic <span class="im">from</span> <span class="st">&#39;next/dynamic&#39;</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> Layout <span class="im">from</span> <span class="st">&#39;@/components/Layout&#39;</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> Frame <span class="im">from</span> <span class="st">&#39;@/components/Frame&#39;</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { LineSlicer } <span class="im">from</span> <span class="st">&#39;@/components/slicers&#39;</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> StatCard <span class="im">from</span> <span class="st">&#39;@/components/StatCard&#39;</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { getChartIcon } <span class="im">from</span> <span class="st">&#39;@/lib/CentralIcon&#39;</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { formatCurrencyKPI<span class="op">,</span> formatIntegerKPI<span class="op">,</span> formatMoMChange<span class="op">,</span> formatNumericKPI<span class="op">,</span> formatPercentageKPI } <span class="im">from</span> <span class="st">&#39;@/lib/formatHelpers&#39;</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { getAllUSCKPIsWithMoM } <span class="im">from</span> <span class="st">&#39;@/lib/USCDailyAverageAndMoM&#39;</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Dynamic imports for charts (SSR fix)</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> LineChart <span class="op">=</span> <span class="fu">dynamic</span>(() <span class="kw">=&gt;</span> <span class="im">import</span>(<span class="st">&#39;@/components/LineChart&#39;</span>)<span class="op">,</span> { ssr<span class="op">:</span> <span class="kw">false</span> })</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> BarChart <span class="op">=</span> <span class="fu">dynamic</span>(() <span class="kw">=&gt;</span> <span class="im">import</span>(<span class="st">&#39;@/components/BarChart&#39;</span>)<span class="op">,</span> { ssr<span class="op">:</span> <span class="kw">false</span> })</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="im">default</span> <span class="kw">function</span> <span class="fu">USCOverviewPage</span>() {</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 1. STATE MANAGEMENT</span></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> [isMounted<span class="op">,</span> setIsMounted] <span class="op">=</span> <span class="fu">useState</span>(<span class="kw">false</span>)</span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> [kpiData<span class="op">,</span> setKpiData] <span class="op">=</span> <span class="fu">useState</span><span class="op">&lt;</span>USCKPIData <span class="op">|</span> <span class="dt">null</span><span class="op">&gt;</span>(<span class="kw">null</span>)</span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> [momData<span class="op">,</span> setMomData] <span class="op">=</span> <span class="fu">useState</span><span class="op">&lt;</span>USCKPIData <span class="op">|</span> <span class="dt">null</span><span class="op">&gt;</span>(<span class="kw">null</span>)</span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> [slicerOptions<span class="op">,</span> setSlicerOptions] <span class="op">=</span> <span class="fu">useState</span><span class="op">&lt;</span>SlicerOptions <span class="op">|</span> <span class="dt">null</span><span class="op">&gt;</span>(<span class="kw">null</span>)</span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> [selectedYear<span class="op">,</span> setSelectedYear] <span class="op">=</span> <span class="fu">useState</span>(<span class="st">&#39;&#39;</span>)</span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> [selectedMonth<span class="op">,</span> setSelectedMonth] <span class="op">=</span> <span class="fu">useState</span>(<span class="st">&#39;&#39;</span>)</span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> [selectedCurrency] <span class="op">=</span> <span class="fu">useState</span>(<span class="st">&#39;USC&#39;</span>) <span class="co">// Locked</span></span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> [selectedLine<span class="op">,</span> setSelectedLine] <span class="op">=</span> <span class="fu">useState</span>(<span class="st">&#39;&#39;</span>)</span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> [isLoading<span class="op">,</span> setIsLoading] <span class="op">=</span> <span class="fu">useState</span>(<span class="kw">true</span>)</span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> [dailyAverages<span class="op">,</span> setDailyAverages] <span class="op">=</span> <span class="fu">useState</span>({ <span class="op">...</span> })</span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> [srChartData<span class="op">,</span> setSrChartData] <span class="op">=</span> <span class="fu">useState</span><span class="op">&lt;</span><span class="dt">any</span><span class="op">&gt;</span>(<span class="kw">null</span>)</span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 2. HYDRATION FIX</span></span>
<span id="cb44-32"><a href="#cb44-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">useEffect</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb44-33"><a href="#cb44-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setIsMounted</span>(<span class="kw">true</span>)</span>
<span id="cb44-34"><a href="#cb44-34" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span> [])</span>
<span id="cb44-35"><a href="#cb44-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-36"><a href="#cb44-36" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 3. LOAD SLICER OPTIONS</span></span>
<span id="cb44-37"><a href="#cb44-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">useEffect</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb44-38"><a href="#cb44-38" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> loadSlicerOptions <span class="op">=</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb44-39"><a href="#cb44-39" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(<span class="st">&#39;/api/usc-overview/slicer-options&#39;</span>)</span>
<span id="cb44-40"><a href="#cb44-40" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> result <span class="op">=</span> <span class="cf">await</span> response<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb44-41"><a href="#cb44-41" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb44-42"><a href="#cb44-42" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (result<span class="op">.</span><span class="at">success</span>) {</span>
<span id="cb44-43"><a href="#cb44-43" aria-hidden="true" tabindex="-1"></a>        <span class="fu">setSlicerOptions</span>(result<span class="op">.</span><span class="at">data</span>)</span>
<span id="cb44-44"><a href="#cb44-44" aria-hidden="true" tabindex="-1"></a>        <span class="fu">setSelectedYear</span>(result<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="at">defaults</span><span class="op">.</span><span class="at">year</span>)</span>
<span id="cb44-45"><a href="#cb44-45" aria-hidden="true" tabindex="-1"></a>        <span class="fu">setSelectedMonth</span>(result<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="at">defaults</span><span class="op">.</span><span class="at">month</span>)</span>
<span id="cb44-46"><a href="#cb44-46" aria-hidden="true" tabindex="-1"></a>        <span class="fu">setSelectedLine</span>(result<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="at">defaults</span><span class="op">.</span><span class="at">line</span>)</span>
<span id="cb44-47"><a href="#cb44-47" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb44-48"><a href="#cb44-48" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb44-49"><a href="#cb44-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">loadSlicerOptions</span>()</span>
<span id="cb44-50"><a href="#cb44-50" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span> [])</span>
<span id="cb44-51"><a href="#cb44-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-52"><a href="#cb44-52" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 4. LOAD KPI DATA (for StatCard)</span></span>
<span id="cb44-53"><a href="#cb44-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">useEffect</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb44-54"><a href="#cb44-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>selectedYear <span class="op">||</span> <span class="op">!</span>selectedMonth <span class="op">||</span> <span class="op">!</span>selectedLine) <span class="cf">return</span></span>
<span id="cb44-55"><a href="#cb44-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-56"><a href="#cb44-56" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> loadKPIData <span class="op">=</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb44-57"><a href="#cb44-57" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> result <span class="op">=</span> <span class="cf">await</span> <span class="fu">getAllUSCKPIsWithMoM</span>(selectedYear<span class="op">,</span> selectedMonth<span class="op">,</span> selectedLine)</span>
<span id="cb44-58"><a href="#cb44-58" aria-hidden="true" tabindex="-1"></a>      <span class="fu">setKpiData</span>(result<span class="op">.</span><span class="at">current</span>)</span>
<span id="cb44-59"><a href="#cb44-59" aria-hidden="true" tabindex="-1"></a>      <span class="fu">setMomData</span>(result<span class="op">.</span><span class="at">mom</span>)</span>
<span id="cb44-60"><a href="#cb44-60" aria-hidden="true" tabindex="-1"></a>      <span class="fu">setDailyAverages</span>({ <span class="op">...</span> })</span>
<span id="cb44-61"><a href="#cb44-61" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb44-62"><a href="#cb44-62" aria-hidden="true" tabindex="-1"></a>    <span class="fu">loadKPIData</span>()</span>
<span id="cb44-63"><a href="#cb44-63" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span> [selectedYear<span class="op">,</span> selectedMonth<span class="op">,</span> selectedLine])</span>
<span id="cb44-64"><a href="#cb44-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-65"><a href="#cb44-65" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 5. LOAD CHART DATA (for Charts)</span></span>
<span id="cb44-66"><a href="#cb44-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">useEffect</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb44-67"><a href="#cb44-67" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>selectedYear <span class="op">||</span> <span class="op">!</span>selectedLine) <span class="cf">return</span></span>
<span id="cb44-68"><a href="#cb44-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-69"><a href="#cb44-69" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> loadChartData <span class="op">=</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb44-70"><a href="#cb44-70" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(<span class="vs">`/api/usc-overview/chart-data?line=</span><span class="sc">${</span>selectedLine<span class="sc">}</span><span class="vs">&amp;year=</span><span class="sc">${</span>selectedYear<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb44-71"><a href="#cb44-71" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> result <span class="op">=</span> <span class="cf">await</span> response<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb44-72"><a href="#cb44-72" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Process chart data</span></span>
<span id="cb44-73"><a href="#cb44-73" aria-hidden="true" tabindex="-1"></a>      <span class="fu">setSrChartData</span>(chartData)</span>
<span id="cb44-74"><a href="#cb44-74" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb44-75"><a href="#cb44-75" aria-hidden="true" tabindex="-1"></a>    <span class="fu">loadChartData</span>()</span>
<span id="cb44-76"><a href="#cb44-76" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span> [selectedYear<span class="op">,</span> selectedLine])</span>
<span id="cb44-77"><a href="#cb44-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-78"><a href="#cb44-78" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 6. CUSTOM SUBHEADER</span></span>
<span id="cb44-79"><a href="#cb44-79" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> customSubHeader <span class="op">=</span> (</span>
<span id="cb44-80"><a href="#cb44-80" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span>div className<span class="op">=</span><span class="st">&quot;dashboard-subheader&quot;</span><span class="op">&gt;</span></span>
<span id="cb44-81"><a href="#cb44-81" aria-hidden="true" tabindex="-1"></a>      {<span class="co">/* Slicers here */</span>}</span>
<span id="cb44-82"><a href="#cb44-82" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;/</span>div<span class="op">&gt;</span></span>
<span id="cb44-83"><a href="#cb44-83" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb44-84"><a href="#cb44-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-85"><a href="#cb44-85" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 7. RENDER</span></span>
<span id="cb44-86"><a href="#cb44-86" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>isMounted) <span class="cf">return</span> <span class="op">&lt;</span>LoadingState <span class="op">/&gt;</span></span>
<span id="cb44-87"><a href="#cb44-87" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (isLoading) <span class="cf">return</span> <span class="op">&lt;</span>LoadingState <span class="op">/&gt;</span></span>
<span id="cb44-88"><a href="#cb44-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-89"><a href="#cb44-89" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (</span>
<span id="cb44-90"><a href="#cb44-90" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span>Layout customSubHeader<span class="op">=</span>{customSubHeader}<span class="op">&gt;</span></span>
<span id="cb44-91"><a href="#cb44-91" aria-hidden="true" tabindex="-1"></a>      <span class="op">&lt;</span>Frame variant<span class="op">=</span><span class="st">&quot;standard&quot;</span><span class="op">&gt;</span></span>
<span id="cb44-92"><a href="#cb44-92" aria-hidden="true" tabindex="-1"></a>        <span class="op">&lt;</span>div style<span class="op">=</span>{{ display<span class="op">:</span> <span class="st">&#39;flex&#39;</span><span class="op">,</span> flexDirection<span class="op">:</span> <span class="st">&#39;column&#39;</span><span class="op">,</span> gap<span class="op">:</span> <span class="st">&#39;20px&#39;</span><span class="op">,</span> marginTop<span class="op">:</span> <span class="st">&#39;20px&#39;</span> }}<span class="op">&gt;</span></span>
<span id="cb44-93"><a href="#cb44-93" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb44-94"><a href="#cb44-94" aria-hidden="true" tabindex="-1"></a>          {<span class="co">/* ROW 1: KPI CARDS */</span>}</span>
<span id="cb44-95"><a href="#cb44-95" aria-hidden="true" tabindex="-1"></a>          <span class="op">&lt;</span>div className<span class="op">=</span><span class="st">&quot;kpi-row&quot;</span><span class="op">&gt;</span></span>
<span id="cb44-96"><a href="#cb44-96" aria-hidden="true" tabindex="-1"></a>            <span class="op">&lt;</span>StatCard <span class="op">...</span> <span class="op">/&gt;</span></span>
<span id="cb44-97"><a href="#cb44-97" aria-hidden="true" tabindex="-1"></a>            <span class="op">&lt;</span>StatCard <span class="op">...</span> <span class="op">/&gt;</span></span>
<span id="cb44-98"><a href="#cb44-98" aria-hidden="true" tabindex="-1"></a>            {<span class="co">/* 6 cards total */</span>}</span>
<span id="cb44-99"><a href="#cb44-99" aria-hidden="true" tabindex="-1"></a>          <span class="op">&lt;/</span>div<span class="op">&gt;</span></span>
<span id="cb44-100"><a href="#cb44-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-101"><a href="#cb44-101" aria-hidden="true" tabindex="-1"></a>          {<span class="co">/* ROW 2: CHARTS */</span>}</span>
<span id="cb44-102"><a href="#cb44-102" aria-hidden="true" tabindex="-1"></a>          <span class="op">&lt;</span>div className<span class="op">=</span><span class="st">&quot;grid grid-cols-1 md:grid-cols-3 gap-6 mb-6&quot;</span><span class="op">&gt;</span></span>
<span id="cb44-103"><a href="#cb44-103" aria-hidden="true" tabindex="-1"></a>            <span class="op">&lt;</span>LineChart <span class="op">...</span> <span class="op">/&gt;</span></span>
<span id="cb44-104"><a href="#cb44-104" aria-hidden="true" tabindex="-1"></a>            <span class="op">&lt;</span>LineChart <span class="op">...</span> <span class="op">/&gt;</span></span>
<span id="cb44-105"><a href="#cb44-105" aria-hidden="true" tabindex="-1"></a>            <span class="op">&lt;</span>LineChart <span class="op">...</span> <span class="op">/&gt;</span></span>
<span id="cb44-106"><a href="#cb44-106" aria-hidden="true" tabindex="-1"></a>          <span class="op">&lt;/</span>div<span class="op">&gt;</span></span>
<span id="cb44-107"><a href="#cb44-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-108"><a href="#cb44-108" aria-hidden="true" tabindex="-1"></a>          {<span class="co">/* ROW 3: MORE CHARTS */</span>}</span>
<span id="cb44-109"><a href="#cb44-109" aria-hidden="true" tabindex="-1"></a>          <span class="op">&lt;</span>div className<span class="op">=</span><span class="st">&quot;grid grid-cols-1 md:grid-cols-3 gap-6 mb-6&quot;</span><span class="op">&gt;</span></span>
<span id="cb44-110"><a href="#cb44-110" aria-hidden="true" tabindex="-1"></a>            <span class="op">&lt;</span>BarChart <span class="op">...</span> <span class="op">/&gt;</span></span>
<span id="cb44-111"><a href="#cb44-111" aria-hidden="true" tabindex="-1"></a>            <span class="op">&lt;</span>BarChart <span class="op">...</span> <span class="op">/&gt;</span></span>
<span id="cb44-112"><a href="#cb44-112" aria-hidden="true" tabindex="-1"></a>            <span class="op">&lt;</span>LineChart <span class="op">...</span> <span class="op">/&gt;</span></span>
<span id="cb44-113"><a href="#cb44-113" aria-hidden="true" tabindex="-1"></a>          <span class="op">&lt;/</span>div<span class="op">&gt;</span></span>
<span id="cb44-114"><a href="#cb44-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-115"><a href="#cb44-115" aria-hidden="true" tabindex="-1"></a>        <span class="op">&lt;/</span>div<span class="op">&gt;</span></span>
<span id="cb44-116"><a href="#cb44-116" aria-hidden="true" tabindex="-1"></a>      <span class="op">&lt;/</span>Frame<span class="op">&gt;</span></span>
<span id="cb44-117"><a href="#cb44-117" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;/</span>Layout<span class="op">&gt;</span></span>
<span id="cb44-118"><a href="#cb44-118" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb44-119"><a href="#cb44-119" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>NOTE</strong>: Detailed page structure patterns sudah
dijelaskan di Sections 16-19 (Overview, Business Performance, Member
Report, Customer Retention patterns).</p>
<h2 data-number="1.31" id="ðÿš-summary-checklist-1"><span
class="header-section-number">1.31</span> ðŸ“Š SUMMARY CHECKLIST</h2>
<p>Ketika membuat page baru, pastikan:</p>
<h3 data-number="1.31.1" id="âœ-slicer"><span
class="header-section-number">1.31.1</span> âœ… SLICER</h3>
<ul class="task-list">
<li><label><input type="checkbox" />API route untuk slicer options
dengan brand filtering</label></li>
<li><label><input type="checkbox" />Dynamic month filtering based on
year</label></li>
<li><label><input type="checkbox" />Currency lock (jika
currency-specific page)</label></li>
<li><label><input type="checkbox" />Default values dari latest
record</label></li>
<li><label><input type="checkbox" />SubHeader dengan Year, Month, Line
slicers</label></li>
<li><label><input type="checkbox" />Brand access control
implemented</label></li>
</ul>
<h3 data-number="1.31.2" id="âœ-data-loading"><span
class="header-section-number">1.31.2</span> âœ… DATA LOADING</h3>
<ul class="task-list">
<li><label><input type="checkbox" />Slicer options useEffect dengan
brand header</label></li>
<li><label><input type="checkbox" />KPI data useEffect
(month-dependent)</label></li>
<li><label><input type="checkbox" />Chart data useEffect
(year-dependent)</label></li>
<li><label><input type="checkbox" />Hydration fix
(isMounted)</label></li>
<li><label><input type="checkbox" />Loading states</label></li>
<li><label><input type="checkbox" />Error handling</label></li>
</ul>
<h3 data-number="1.31.3" id="âœ-kpi-cards"><span
class="header-section-number">1.31.3</span> âœ… KPI CARDS</h3>
<ul class="task-list">
<li><label><input type="checkbox" />6 cards dalam 1 row (grid-cols-6,
gap 18px)</label></li>
<li><label><input type="checkbox" />StatCard dengan Daily
Average</label></li>
<li><label><input type="checkbox" />StatCard dengan MoM
comparison</label></li>
<li><label><input type="checkbox" />Icon dari CentralIcon</label></li>
<li><label><input type="checkbox" />Format menggunakan
formatHelpers</label></li>
<li><label><input type="checkbox" />Fixed height: 120px</label></li>
</ul>
<h3 data-number="1.31.4" id="âœ-charts"><span
class="header-section-number">1.31.4</span> âœ… CHARTS</h3>
<ul class="task-list">
<li><label><input type="checkbox" />LineChart untuk trends (dynamic
import)</label></li>
<li><label><input type="checkbox" />BarChart untuk comparisons (dynamic
import)</label></li>
<li><label><input type="checkbox" />Dual Y-axes untuk 2-series
charts</label></li>
<li><label><input type="checkbox" />Chart icons di header</label></li>
<li><label><input type="checkbox" />Legend di header (bukan di chart
area)</label></li>
<li><label><input type="checkbox" />Min height: 350px</label></li>
<li><label><input type="checkbox" />Hover effects (translateY
-3px)</label></li>
<li><label><input type="checkbox" />Data labels for bars</label></li>
</ul>
<h3 data-number="1.31.5" id="âœ-formatting"><span
class="header-section-number">1.31.5</span> âœ… FORMATTING</h3>
<ul class="task-list">
<li><label><input type="checkbox" />Currency: <code>RM 0,000.00</code>
(2 decimal)</label></li>
<li><label><input type="checkbox" />Integer: <code>0,000</code> (no
decimal)</label></li>
<li><label><input type="checkbox" />Numeric: <code>0,000.00</code> (2
decimal)</label></li>
<li><label><input type="checkbox" />Percentage:
<code>0.00%</code></label></li>
<li><label><input type="checkbox" />MoM: <code>+0.00%</code> atau
<code>-0.00%</code> (with sign)</label></li>
</ul>
<h3 data-number="1.31.6" id="âœ-styling"><span
class="header-section-number">1.31.6</span> âœ… STYLING</h3>
<ul class="task-list">
<li><label><input type="checkbox" />White background untuk cards
(#ffffff)</label></li>
<li><label><input type="checkbox" />Hover effects
(translateY)</label></li>
<li><label><input type="checkbox" />Grid gaps: 18px
(CENTRALIZED)</label></li>
<li><label><input type="checkbox" />Chart height: min 350px</label></li>
<li><label><input type="checkbox" />Border radius: 8px</label></li>
<li><label><input type="checkbox" />Colors: Blue (#3B82F6) + Orange
(#F97316)</label></li>
</ul>
<h3 data-number="1.31.7" id="âœ-advanced"><span
class="header-section-number">1.31.7</span> âœ… ADVANCED</h3>
<ul class="task-list">
<li><label><input type="checkbox" />Server-side filtering (if
applicable)</label></li>
<li><label><input type="checkbox" />Brand access control di ALL
APIs</label></li>
<li><label><input type="checkbox" />Export functionality</label></li>
<li><label><input type="checkbox" />Drill-down modals (if
applicable)</label></li>
<li><label><input type="checkbox" />Transaction history (if retention
page)</label></li>
<li><label><input type="checkbox" />Target comparison (if BP
page)</label></li>
</ul>
<hr />
<h2 data-number="1.32" id="ðÿž-final-notes"><span
class="header-section-number">1.32</span> ðŸŽ¯ FINAL NOTES</h2>
<p><strong>CRITICAL RULES</strong> [[memory:7712339]]: 1. âŒ <strong>NO
DUMMY DATA</strong> - Semua data dari Supabase 2. âœ…
<strong>API-FIRST</strong> - Slicers auto-fetch dari database<br />
3. âœ… <strong>REAL-TIME</strong> - Data selalu up-to-date 4. âœ…
<strong>CURRENCY LOCK</strong> - MYR/SGD/USC pages lock currency 5. âœ…
<strong>STANDARD COMPONENTS</strong> - Gunakan StatCard, LineChart,
BarChart 6. âœ… <strong>FORMAT CONSISTENCY</strong> - Gunakan
formatHelpers 7. âœ… <strong>DAILY AVERAGE</strong> - Semua KPI cards
punya Daily Average 8. âœ… <strong>MOM COMPARISON</strong> - Semua KPI
cards punya MoM 9. âœ… <strong>DUAL Y-AXES</strong> - Charts dengan 2
series 10. âœ… <strong>ICON SYSTEM</strong> - Gunakan CentralIcon untuk
semua icons 11. âœ… <strong>BRAND ACCESS</strong> - Squad Lead filtering
everywhere (Nov 2025) 12. âœ… <strong>SERVER-SIDE FILTER</strong> -
Filter di server untuk performance (Nov 2025)</p>
<p><strong>NEW in Version 2.0</strong>: - âœ… Expanded coverage: USC
only â†’ ALL 42 pages (MYR, SGD, USC, Admin) - âœ… Added: Server-side
filtering patterns - âœ… Added: Brand access control (Squad Lead vs
Admin) - âœ… Added: Transaction history drill-down - âœ… Added: Export
with filter support - âœ… Updated: All components (34 components) - âœ…
Updated: All API patterns (94 routes) - âœ… Updated: KPI formulas (55+
KPIs) - âœ… Added: Comprehensive checklists &amp; troubleshooting</p>
<p><strong>Related Documentation</strong>: -
<code>CRM_DASHBOARD_HANDBOOK.md</code> - Development handbook -
<code>COMPREHENSIVE_PROJECT_SCAN_REPORT.md</code> - Complete project
scan (2380 lines) - <code>COMPONENTS_LIBRARY.md</code> - Component
reference (908 lines) - <code>CBO_VISUALIZATION_STANDARDS.md</code> -
Visualization standards -
<code>CBO_FRONTEND_FRAMEWORK_STANDARD.md</code> - Frontend framework</p>
<hr />
<p><strong>Document Version</strong>: 2.0 (Updated &amp; Expanded)<br />
<strong>Last Updated</strong>: November 7, 2025<br />
<strong>Coverage</strong>: ALL 42 Production Pages + 94 API Routes + 34
Components<br />
<strong>Scope</strong>: MYR + SGD + USC + Admin pages<br />
<strong>Status</strong>: âœ… PRODUCTION READY</p>
<p><strong>Changes from v1.0</strong>: - âœ… Updated date: Oct 14 â†’
Nov 7, 2025 - âœ… Expanded scope: USC Overview only â†’ ALL 42
pages<br />
- âœ… Added: Server-side filtering patterns - âœ… Added: Brand access
control (Squad Lead vs Admin) - âœ… Added: Transaction history
drill-down patterns - âœ… Added: Export functionality standards - âœ…
Added: Page patterns (Overview, BP, Member Report, Retention) - âœ…
Added: Database architecture section - âœ… Added: Complete KPI reference
(55+ KPIs) - âœ… Added: Comprehensive checklists (3 types) - âœ… Added:
Troubleshooting guide (10 common issues) - âœ… Updated: Component
library (34 components) - âœ… Updated: API patterns (94 routes) - âœ…
Updated: Format standards (ALL markets)</p>
<p><strong>For detailed project analysis, see</strong>:
<code>COMPREHENSIVE_PROJECT_SCAN_REPORT.md</code></p>
<hr />
<p><strong>END OF DOCUMENT - Version 2.0</strong></p>
<p><em>This document has been updated to v2.0 with comprehensive
coverage untuk ALL 42 production pages across MYR, SGD, and USC markets.
All new features from November 2025 updates have been included.</em></p>
</body>
</html>
